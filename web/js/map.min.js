var bounds1=9984,bounds2=9984,mapMinZoom=-3,mapMaxZoom=1,map=L.map("map_tadinthadar",{maxZoom:mapMaxZoom,minZoom:mapMinZoom,crs:L.CRS.Simple}),mapBounds=new L.LatLngBounds(map.unproject([0,bounds1],mapMaxZoom),map.unproject([bounds2,0],mapMaxZoom));map.setView(map.unproject([3940,2457],mapMaxZoom),mapMaxZoom),L.tileLayer("http://www.tadinthadar.com/tiles/{z}/{x}_{y}.png",{minZoom:mapMinZoom,maxZoom:mapMaxZoom,bounds:mapBounds,noWrap:!1,continuousWorld:!1}).addTo(map);var markers=L.layerGroup(),mapProvinces=L.layerGroup(),mapRegions=L.layerGroup(),mapRealms=L.layerGroup(),overlayMaps={Markers:markers,"Individual Provinces":mapProvinces,"Counties & Duchies":mapRegions,Realms:mapRealms};L.control.layers(null,overlayMaps).addTo(map),markers.addTo(map),mapProvinces.addTo(map),mapRealms.addTo(map);var helpers=["helper_1","helper_2","helper_3","helper_4","helper_5","helper_6","helper_7","helper_8","helper_9","helper_10","helper_11"],nextHelper=12,profileMouseOverAreas=[],profileClickableAreas=[],minMaxClickableProfileBounds=null,minMaxProfileBounds=null,provinceMouseOverAreas=[],provinceClickableAreas=[],minMaxClickableProvinceBounds=null,minMaxProvinceBounds=null;function onOverlayAdd(e){"Provinces"!=e.name&&map.hasLayer(mapProvinces)&&mapProvinces.eachLayer(function(e){e.bringToFront()})}function getPos(e,t){return map.unproject([e,t],mapMaxZoom)}function updateOpacity(e,t){var a=t;"province"==e?mapProvinces.eachLayer(function(e){e.hasOwnProperty("options")&&e.options.hasOwnProperty("fill")&&e.setStyle({fillOpacity:a})}):"region"==e?mapRegions.eachLayer(function(e){e.hasOwnProperty("options")&&e.options.hasOwnProperty("fill")&&e.setStyle({fillOpacity:a})}):mapRealms.eachLayer(function(e){e.hasOwnProperty("options")&&e.options.hasOwnProperty("fill")&&e.setStyle({fillOpacity:a})})}function GetWikiUrl(e){return""!=e.WikiUrl?e.WikiUrl:0!=e.parent&&titles.has(e.parent)?GetWikiUrl(titles.get(e.parent)):""}function renderOwner(e){if(clearCanvas("profile"),document.getElementById("loadingScreen").style.display="block",document.getElementById("profile").style.display="none",characterMap.has(e)){var t=characterMap.get(e),a=new RenderStack;renderCharacter(t,[0,0,0],a,"profile",helpers),a.callback=function(){if(profileMouseOverAreas&&profileMouseOverAreas.length>0){var e=document.getElementById("profile");e.offsetLeft,e.offsetTop;minMaxClickableProfileBounds=getMinMaxBounds(profileMouseOverAreas),minMaxProfileBounds=getMinMaxBounds(profileMouseOverAreas),profileClicker=function(e){var t=e.offsetX,a=e.offsetY;if(null!=minMaxClickableProfileBounds&&minMaxClickableProfileBounds.isInShape(t,a))for(var r=0;r<profileClickableAreas.length;r++)if(profileClickableAreas[r].isInShape(t,a)){profileClickableAreas[r].action&&profileClickableAreas[r].action();break}},profileMover=function(e){var t=e.offsetX,a=e.offsetY;if($("#profile").attr("title",""),null!=minMaxProfileBounds&&minMaxProfileBounds.isInShape(t,a))for(var r=0;r<profileMouseOverAreas.length;r++)if(profileMouseOverAreas[r].isInShape(t,a)){$("#profile").attr("title",profileMouseOverAreas[r].description);break}},profileClicker&&e.addEventListener("click",profileClicker,!0),profileMover&&e.addEventListener("mousemove",profileMover,!1),document.getElementById("loadingScreen").style.display="none",document.getElementById("profile").style.display="block",$("html, body").animate({scrollTop:$(document).height()},"slow")}},loadRenderStack(a)}}function renderCounty(e){if(clearCanvas("province"),clearCanvas("province_helper"),clearEvents("province",clicker,mover),titles.has(e)){var t=titles.get(e),a=1==t.titleImportance?t.parent:t;provinceMouseOverAreas=[],provinceClickableAreas=[];var r=renderProvince(a,"province"),i=new RenderStack;i.addElements(r);var n=getTitleOwner(a);if(0!=n&&characterMap.has(n)){var s=characterMap.get(n),l=renderCharacterPortrait(s,[0,0,1e3],"province_helper",!0,!0),o=new RenderedImage(49,49,2e3,130,130,"province_helper","province");provinceMouseOverAreas.push(new MouseOverShape(49,49,179,179,getFullNameWithPrimaryTitleLocation(s))),provinceClickableAreas.push(new ClickableShape(49,49,179,179,"Portrait",makeCharacterRenderFunc(s))),i.addElements(l),i.addElement(o)}i.callback=function(){if(provinceMouseOverAreas&&provinceMouseOverAreas.length>0){var e=document.getElementById("province");e.offsetLeft,e.offsetTop;minMaxClickableProvinceBounds=getMinMaxBounds(provinceMouseOverAreas),minMaxProvinceBounds=getMinMaxBounds(provinceMouseOverAreas),clicker=function(e){var t=e.offsetX,a=e.offsetY;if(null!=minMaxClickableProvinceBounds&&minMaxClickableProvinceBounds.isInShape(t,a))for(var r=0;r<provinceClickableAreas.length;r++)if(provinceClickableAreas[r].isInShape(t,a)){provinceClickableAreas[r].action&&provinceClickableAreas[r].action();break}},mover=function(e){var t=e.offsetX,a=e.offsetY;if($("#province").attr("title",""),null!=minMaxProvinceBounds&&minMaxProvinceBounds.isInShape(t,a))for(var r=0;r<provinceMouseOverAreas.length;r++)if(provinceMouseOverAreas[r].isInShape(t,a)){$("#province").attr("title",provinceMouseOverAreas[r].description);break}},clicker&&e.addEventListener("click",clicker,!0),mover&&e.addEventListener("mousemove",mover,!1),$("html, body").animate({scrollTop:$(document).height()},"slow")}},loadRenderStack(i)}}function initDataForm(){$("#save_zip").click(function(){renderMapIcons()}),document.getElementById("ctFile").onchange=function(e){try{let t=e.target.files;if(!t.length)return void alert("No file selected!");let a=t[0],r=new FileReader;r.onload=(e=>{loadCtJson(e.target.result)}),r.readAsText(a)}catch(e){console.error(e)}},document.getElementById("mapFile").onchange=function(e){try{let t=e.target.files;if(!t.length)return void alert("No file selected!");let a=t[0],r=new FileReader;r.onload=(e=>{loadMapJson(e.target.result)}),r.readAsText(a)}catch(e){console.error(e)}}}function loadCtJson(e){$("#ct-data-loaded").prop("checked",!0),loadJson(e),refreshMemoryStats()}function loadMapJson(e){$("#map-data-loaded").prop("checked",!0)}function refreshMemoryStats(){$("#characterCount").html(characterMap.size),$("#titleCount").html(titles.size),$("#houseCount").html(houses.size)}function sanityCheck(){for(var e=!0;e;)for(var[t,a]of characterMap.entries())e=a.sanityCheck();for(e=!0;e;)for(var[t,a]of titles.entries())e=titleSanityCheck(a)}function loadJson(e){var t=JSON.parse(e),a=new DataLoader,r=0,i=0,n=0;if(t.characters)for(var s=0;s<t.characters.length;s++)if(t.characters[s].length>1){var l=parseInt(t.characters[s][0]);r=Math.max(l,r);var o=t.characters[s][1];Object.setPrototypeOf(o,Character.prototype),a.characters.set(l,o)}if(t.houses)for(s=0;s<t.houses.length;s++)if(t.houses[s].length>1){l=parseInt(t.houses[s][0]);n=Math.max(l,n),a.houses.set(l,t.houses[s][1])}if(t.titles)for(s=0;s<t.titles.length;s++)if(t.titles[s].length>1){l=parseInt(t.titles[s][0]);i=Math.max(l,i);var h=t.titles[s][1];5==h.titleImportance?Object.setPrototypeOf(h,Empire.prototype):4==h.titleImportance?Object.setPrototypeOf(h,Kingdom.prototype):3==h.titleImportance?Object.setPrototypeOf(h,Duchy.prototype):2==h.titleImportance?Object.setPrototypeOf(h,County.prototype):1==h.titleImportance&&Object.setPrototypeOf(h,Holding.prototype),a.titles.set(l,h)}a instanceof DataLoader&&(characterMap=a.characters,houses=a.houses,titles=a.titles,characterIterator=++r,houseIterator=++n,titleIterator=++i)}map.on("overlayadd",onOverlayAdd),window.onload=function(){clicker=null,mover=null,profileClicker=null,profileMover=null;for(var e=0;e<200;e++){var t=document.createElement("canvas");t.id="helper_"+nextHelper,nextHelper++,t.width=200,t.height=200,t.style.display="none",document.body.appendChild(t),helpers.push(t.id)}loadJson(staticMapInfo);sanityCheck();var a=JSON.parse(staticMapData);for(e=0;e<a.length;e++){var r=a[e];Object.setPrototypeOf(r,MapData.prototype);var i="";if(0!=r.title&&titles.has(r.title)){var n=GetWikiUrl(titles.get(r.title));""!=n&&(i="<br><a href='"+n+"' target='_blank'>Wiki Entry</a>")}if(r.IsMarker()){var s=r.GetImageUrl();if(""!=s){var l="map"==s.substring(0,3)?[61.5,60]:[42,40],o=L.icon({iconUrl:s,iconSize:[40,l[0]],iconAnchor:[20,l[1]],popupAnchor:[0,-l[1]]});L.marker(r.GetMarkerPosition(),{icon:o}).addTo("Realm"==r.group?mapRealms:markers).bindPopup("<b>"+r.name+"</b>"+i)}else L.marker(r.GetMarkerPosition()).addTo("Realm"==r.group?mapRealms:markers).bindPopup("<b>"+r.name+"</b>"+i)}if(r.IsPolygon()){var h="Realm"==r.group?r.fillColor:r.strokeColor,p=L.polygon(r.GetBoundaryPositions(),{color:r.strokeColor,weight:1,opacity:r.strokeOpacity,fillOpacity:r.fillOpacity,fill:!0,fillColor:h}).addTo("Province"==r.group?mapProvinces:"Region"==r.group?mapRegions:mapRealms),c=r.name,d=!1;r.title>0&&titles.has(r.title)&&r.UseTitleInfo()&&(c=getTitleMouseOverText(titles.get(r.title)),d=!0),p.bindPopup("<b>"+c+"</b>"+i),p.title=r.title,d&&p.on("click",function(e){if(e.hasOwnProperty("target")&&e.target.hasOwnProperty("title")){var t=e.target.title;if(titles.has(t)){var a=titles.get(t);a.titleImportance<=2?renderCounty(t):0!=a.owner&&characterMap.has(a.owner)&&renderOwner(a.owner)}}})}}};const traitGroup={EDUCATION:"Education",HEALTH:"Health",BIRTH:"Birth",GENETIC:"Genetic",LIFESTYLE:"Lifestyle",PERSONALITY:"Personality",KINSLAYER:"Kinslayer",SPECIAL:"Special"};function Trait(e,t,a,r,i,n,s,l,o,h,p){this.name=e,this.id=t,this.internal_name=a,this.group=r,this.diplomacy=i,this.martial=n,this.stewardship=s,this.intrigue=l,this.learning=o,this.combat=h,this.description=p}Trait.prototype.getMouseOverText=function(){var e=this.description.length>0?this.name+"\n"+this.description:this.name;return 0!=this.diplomacy&&(e=e+"\nDiplomacy: "+(this.diplomacy>=0?"+"+this.diplomacy:this.diplomacy)),0!=this.martial&&(e=e+"\nMartial: "+(this.martial>0?"+"+this.martial:this.martial)),0!=this.stewardship&&(e=e+"\nStewardship: "+(this.stewardship>0?"+"+this.stewardship:this.stewardship)),0!=this.intrigue&&(e=e+"\nIntrigue: "+(this.intrigue>0?"+"+this.intrigue:this.intrigue)),0!=this.learning&&(e=e+"\nLearning: "+(this.learning>0?"+"+this.learning:this.learning)),0!=this.combat&&(e=e+"\nPersonal Combat Modifier: "+(this.combat>0?"+"+this.combat:this.combat)),e},Trait.prototype.getImageUrl=function(){return"profile/traits/"+this.getGroupName()+"/"+this.id+".png"},Trait.prototype.getGroupName=function(){return this.group==traitGroup.BIRTH?"birth":this.group==traitGroup.EDUCATION?"education":this.group==traitGroup.GENETIC?"genetic":this.group==traitGroup.HEALTH?"health":this.group==traitGroup.KINSLAYER?"kinslayer":this.group==traitGroup.LIFESTYLE?"lifestyle":this.group==traitGroup.PERSONALITY?"personality":"special"};var traitMap=new Map;function GetTraits(){return traitMap.size>0?traitMap:(traitMap.set(5,new Trait("Naive Appeaser",5,"naive_appeaser",traitGroup.EDUCATION,1,-1,0,0,0,0,"Naive Appeasers want to be well liked and fancy themselves diplomat. Unfortunately, everyone else just tend to bully them.")),traitMap.set(6,new Trait("Underhanded Rogue",6,"underhanded_rogue",traitGroup.EDUCATION,3,-1,0,0,0,0,"The Underhanded Rogue is a rough but decently effective diplomat.")),traitMap.set(7,new Trait("Charismatic Negotiator",7,"charismatic_negotiator",traitGroup.EDUCATION,6,-1,0,1,1,0,"The Charismatic Negotiator is an excellent diplomat, impressing dignitaries with elegant dress and persuasive rhetoric.")),traitMap.set(8,new Trait("Grey Eminence",8,"grey_eminence",traitGroup.EDUCATION,9,-1,0,2,2,0,"The Grey Eminence is the epitome of statesmanship having fully mastered the art of diplomacy.")),traitMap.set(13,new Trait("Misguided Warrior",13,"misguided_warrior",traitGroup.EDUCATION,0,1,0,0,-1,5,"The Misguided Warrior was trained in warfare and the martial arts, but sadly lacks all talent for it.")),traitMap.set(14,new Trait("Tough Soldier",14,"tough_soldier",traitGroup.EDUCATION,0,3,0,0,-1,10,"The Tough Soldier is fearsome on the battlefield, but only a mediocre commander.")),traitMap.set(15,new Trait("Skilled Tactician",15,"skilled_tactician",traitGroup.EDUCATION,0,6,1,1,-1,15,"The Skilled Tactician is an adept of the art of war - a valiant warrior and reliable commander.")),traitMap.set(16,new Trait("Brilliant Strategist",16,"brilliant_strategist",traitGroup.EDUCATION,0,9,2,2,-1,20,"The Brilliant Strategist has an almost preternatural understanding of all things martial, having the perfect makings for a Marshal or military tutor.")),traitMap.set(9,new Trait("Indulgent Wastrel",9,"indulgent_wastrel",traitGroup.EDUCATION,-1,0,1,0,0,0,"The Indulgent Wastrel was groomed to become good with money, and if good means spending it quickly, the Indulgent Wastrel certainly is.")),traitMap.set(10,new Trait("Thrifty Clerk",10,"thrifty_clerk",traitGroup.EDUCATION,-1,0,3,0,0,0,"The Thrifty Clerk is a dutiful, if not particularly skilled, administrator.")),traitMap.set(11,new Trait("Fortune Builder",11,"fortune_builder",traitGroup.EDUCATION,-1,1,6,0,1,0,"The Fortune Builder came out of adolescence armed with a well honed business sense, determined to live a life of luxury.")),traitMap.set(12,new Trait("Midas Touched",12,"midas_touched",traitGroup.EDUCATION,-1,2,9,0,2,0,"This character is truly Midas Touched, never seemingly running out of funds - an excellent choice for Steward and mentor to children destine to become administrators.")),traitMap.set(1,new Trait("Amateurish Plotter",1,"amateurish_plotter",traitGroup.EDUCATION,0,0,-1,1,0,4,"The Amateurish Plotter has received an education emphasizing intrigue skills. Unfortunately, it didn't stick.")),traitMap.set(2,new Trait("Flamboyant Schemer",2,"flamboyant_schemer",traitGroup.EDUCATION,0,0,-1,3,0,8,"Flamboyant Schemers thrive on court intrigue and fancy themselves as master of the trade. However, their lack of secrecy tends to endanger even their best efforts.")),traitMap.set(3,new Trait("Intricate Webweaver",3,"intricate_webweaver",traitGroup.EDUCATION,1,1,-1,6,0,12,"The Intricate Webweaver is a master manipulator, well suited to a life of intrigue.")),traitMap.set(4,new Trait("Elusive Shadow",4,"elusive_shadow",traitGroup.EDUCATION,2,2,-1,9,0,16,"The Elusive Shadow has mastered the art of Intrigue and should make a perfect Spymaster - as well as an ideal mentor for prospective schemers.")),traitMap.set(17,new Trait("Detached Priest",17,"detached_priest",traitGroup.EDUCATION,0,0,0,-1,1,0,"The Detached Priest received a clerical education but displays no talent beyond basic literacy.")),traitMap.set(18,new Trait("Dutiful Cleric",18,"martial_cleric",traitGroup.EDUCATION,0,0,0,-1,3,0,"The Dutiful Cleric is learned and possessed of beautiful penmanship, but lacks particular interest in theology.")),traitMap.set(19,new Trait("Scholarly Theologian",19,"scholarly_theologian",traitGroup.EDUCATION,1,0,1,-1,6,0,"The Scholarly Theologian is wise and well read, with a deep understanding of philosophy and theology.")),traitMap.set(20,new Trait("Mastermind Theologian",20,"mastermind_theologian",traitGroup.EDUCATION,2,0,2,-1,9,0,"The Mastermind Theologian is recognized as one of the top scholars of the Faith.")),traitMap.set(22,new Trait("Depressed",22,"depressed",traitGroup.HEALTH,-1,-1,-1,-1,0,-5,"Life has lost its luster to this character.")),traitMap.set(33,new Trait("Drunkard",33,"drunkard",traitGroup.HEALTH,0,0,-2,0,0,-10,"This character is a drunken sot.")),traitMap.set(231,new Trait("Immortal",231,"immortal",traitGroup.HEALTH,0,0,0,0,0,0,"This character has achieved eternal life and will never succumb to the ravages of old age. The character is not invincible though, physical injury will still hurt them.")),traitMap.set(32,new Trait("Incapable",32,"incapable",traitGroup.HEALTH,-6,-6,-6,-6,-6,-100,"Due to advance age, head injury or other mental disabilities, this character is not fit for any kind of work. Incapable rules must employ a regent.")),traitMap.set(31,new Trait("Infirm",31,"infirm",traitGroup.HEALTH,-3,-3,-3,-3,-3,-50,"This character is infirm and suffers from a sickly disposition.")),traitMap.set(23,new Trait("Lunatic",23,"lunatic",traitGroup.HEALTH,0,0,0,0,0,0,"This character is stark raving mad.")),traitMap.set(30,new Trait("Maimed",30,"maimed",traitGroup.HEALTH,0,-2,0,0,0,-30,"This character has been maimed. It would take a true miracle to heal such an injury.")),traitMap.set(24,new Trait("Possessed",24,"possessed",traitGroup.HEALTH,0,0,0,0,0,5,"This character experiences frequent violent episodes, speaking in tongues, spitting and assaulting those nearby, as if possessed by evil spirits.")),traitMap.set(237,new Trait("Renowned Physician",237,"physician",traitGroup.HEALTH,1,0,0,0,2,0,"This character is a renowned practitioner of medicine and a sought after physician - he would be a welcome addition to the court of any ruler.")),traitMap.set(121,new Trait("Scarred",121,"scarred",traitGroup.HEALTH,0,0,0,0,0,5,"Old wounds have left this character visibly scarred.")),traitMap.set(21,new Trait("Stressed",21,"stressed",traitGroup.HEALTH,0,0,-1,-1,0,-10,"This character finds the burden of work and life almost too much to handle.")),traitMap.set(29,new Trait("Wounded",29,"wounded",traitGroup.HEALTH,0,-1,0,0,0,-15,"This character has been seriously injured, but the damage should heal, given time.")),traitMap.set(36,new Trait("Typhus",36,"has_typhus",traitGroup.HEALTH,-1,0,-2,-1,-2,-40,"")),traitMap.set(34,new Trait("Tuberculosis",34,"has_tuberculosis",traitGroup.HEALTH,-2,0,-1,-2,0,-25,"")),traitMap.set(226,new Trait("Dysentery",226,"dysentery",traitGroup.HEALTH,0,-1,0,-1,0,-20,"")),traitMap.set(225,new Trait("Flu",225,"flu",traitGroup.HEALTH,-1,-1,-1,-1,-1,-10,"")),traitMap.set(228,new Trait("Food Poisoning",228,"food_poisoning",traitGroup.HEALTH,-2,-2,-2,-2,-2,-10,"")),traitMap.set(227,new Trait("Gout",227,"gout",traitGroup.HEALTH,-2,-1,0,0,0,-20,"")),traitMap.set(27,new Trait("Syphilis",27,"syphilitic",traitGroup.HEALTH,-1,-1,-1,-1,-1,0,"")),traitMap.set(25,new Trait("Ill",25,"ill",traitGroup.HEALTH,0,-1,0,0,0,-10,"")),traitMap.set(28,new Trait("Leper",28,"leper",traitGroup.HEALTH,0,0,0,0,0,-25,"")),traitMap.set(38,new Trait("Measles",38,"has_measles",traitGroup.HEALTH,0,0,-2,0,-1,-30,"")),traitMap.set(26,new Trait("Pneumonia",26,"pneumonic",traitGroup.HEALTH,-2,-2,-2,-2,-2,-30,"")),traitMap.set(229,new Trait("Rabies",229,"rabies",traitGroup.HEALTH,-3,0,-2,-3,-2,30,"")),traitMap.set(238,new Trait("Scurvy",238,"scurvy",traitGroup.HEALTH,-1,-1,-1,-1,-1,-20,"")),traitMap.set(39,new Trait("Smallpox",39,"has_small_pox",traitGroup.HEALTH,-2,0,-1,0,-2,-100,"")),traitMap.set(37,new Trait("The Plague",37,"has_bubonic_plague",traitGroup.HEALTH,-2,-3,-2,-3,-2,-100,"")),traitMap.set(222,new Trait("Disfigured",222,"disfigured",traitGroup.HEALTH,-4,0,0,0,0,0,"This character is disfigured - a face few could love.")),traitMap.set(223,new Trait("Mangled",223,"mangled",traitGroup.HEALTH,-2,-2,-2,-2,-2,-40,"This character has been horribly mangled and now lives with a mangled body.")),traitMap.set(219,new Trait("One-Eyed",219,"one_eyed",traitGroup.HEALTH,0,0,0,0,0,-10,"This character is missing an eye - not something you see everyday.")),traitMap.set(220,new Trait("One-Handed",220,"one_handed",traitGroup.HEALTH,0,0,0,0,1,-20,"This character is missing a hand - having only one hand causes problems in combat but makes it easier to escape chores.")),traitMap.set(221,new Trait("One-Legged",221,"one_legged",traitGroup.HEALTH,0,0,0,0,1,-30,"This character is missing a leg - a real disability when it comes to the battlefield or chasing youngsters.")),traitMap.set(224,new Trait("Severely Injured",224,"severely_injured",traitGroup.HEALTH,0,-2,0,-2,0,-20,"This character was recently maimed resulting in serious injury, a life threatening condition. Once the wounds heals their health will recover, but the damage dealt will never fully heal.")),traitMap.set(340,new Trait("Fat",340,"is_fat",traitGroup.HEALTH,0,0,0,0,0,-10,"This character is extremely overweight.")),traitMap.set(341,new Trait("Malnourished",341,"is_malnourished",traitGroup.HEALTH,0,0,0,0,0,-10,"This character has a very fragile health.")),traitMap.set(41,new Trait("Bastard",41,"bastard",traitGroup.BIRTH,-1,0,0,0,0,0,"This character was born out of wedlock and has not been legitimized - and is thus disqualified from the line of succession.")),traitMap.set(133,new Trait("Child of Concubine",133,"child_of_consort",traitGroup.BIRTH,-1,0,0,0,0,0,"This character was born to the concubine of a ruler. Children of concubines can inherit but are somewhat poorly regarded by others.")),traitMap.set(387,new Trait("Child of Consort",387,"child_of_consort_male",traitGroup.BIRTH,-1,0,0,0,0,0,"This character was born to the concubine of a ruler. Children of concubines can inherit but are somewhat poorly regarded by others.")),traitMap.set(43,new Trait("Legitimized Bastard",43,"legit_bastard",traitGroup.BIRTH,-1,0,0,0,0,0,"This character was born a bastard but was legitimized. Legitimized bastards can inherit, though the stain of bastardy can never be entirely cleansed.")),traitMap.set(42,new Trait("Twin",42,"twin",traitGroup.BIRTH,0,0,0,0,0,0,"This character had the fortune of being offered a twin. Twins like each other better.")),traitMap.set(53,new Trait("Attractive",53,"fair",traitGroup.GENETIC,1,0,0,0,0,0,"")),traitMap.set(56,new Trait("Genius",56,"genius",traitGroup.GENETIC,5,5,5,5,5,10,"")),traitMap.set(57,new Trait("Quick",57,"quick",traitGroup.GENETIC,3,3,3,3,3,5,"")),traitMap.set(61,new Trait("Strong",61,"strong",traitGroup.GENETIC,1,2,0,0,0,10,"")),traitMap.set(48,new Trait("Clubfooted",48,"clubfooted",traitGroup.GENETIC,0,-1,0,0,0,-5,"")),traitMap.set(55,new Trait("Dwarf",55,"dwarf",traitGroup.GENETIC,0,-1,0,0,0,-15,"")),traitMap.set(49,new Trait("Harelip",49,"harelip",traitGroup.GENETIC,-1,0,0,0,0,0,"")),traitMap.set(50,new Trait("Hunchback",50,"hunchback",traitGroup.GENETIC,0,-1,0,0,0,0,"")),traitMap.set(59,new Trait("Imbecile",59,"imbecile",traitGroup.GENETIC,-8,-8,-8,-8,-8,-30,"")),traitMap.set(60,new Trait("Inbred",60,"inbred",traitGroup.GENETIC,-5,-5,-5,-5,-5,-20,"")),traitMap.set(51,new Trait("Lisp",51,"lisp",traitGroup.GENETIC,-1,0,0,0,0,0,"")),traitMap.set(58,new Trait("Slow",58,"slow",traitGroup.GENETIC,-3,-3,-3,-3,-3,-5,"")),traitMap.set(52,new Trait("Stutter",52,"stutter",traitGroup.GENETIC,-1,0,0,0,0,0,"")),traitMap.set(54,new Trait("Ugly",54,"ugly",traitGroup.GENETIC,-1,0,0,0,0,0,"")),traitMap.set(62,new Trait("Weak",62,"weak",traitGroup.GENETIC,0,-1,0,0,0,-10,"")),traitMap.set(327,new Trait("Giant",327,"giant",traitGroup.GENETIC,0,0,0,0,0,10,"")),traitMap.set(337,new Trait("Left-Handed",337,"lefthanded",traitGroup.GENETIC,0,0,0,0,0,15,"")),traitMap.set(203,new Trait("Brawny",203,"robust",traitGroup.GENETIC,1,2,0,0,0,10,"")),traitMap.set(339,new Trait("Sturdy",339,"sturdy",traitGroup.GENETIC,0,0,0,0,0,2,"")),traitMap.set(204,new Trait("Frail",204,"feeble",traitGroup.GENETIC,0,-1,0,0,0,-10,"")),traitMap.set(205,new Trait("Shrewd",205,"shrewd",traitGroup.GENETIC,2,2,2,2,2,3,"")),traitMap.set(206,new Trait("Dull",206,"dull",traitGroup.GENETIC,-2,-2,-2,-2,-2,-3,"")),traitMap.set(404,new Trait("Groomed",404,"groomed",traitGroup.GENETIC,0,0,0,0,0,0,"")),traitMap.set(405,new Trait("Uncouth",405,"uncouth",traitGroup.GENETIC,0,0,0,0,0,0,"")),traitMap.set(180,new Trait("Administrator",180,"administrator",traitGroup.LIFESTYLE,0,0,3,0,0,0,"")),traitMap.set(181,new Trait("Architect",181,"architect",traitGroup.LIFESTYLE,0,1,2,0,0,0,"")),traitMap.set(69,new Trait("Duelist",69,"duelist",traitGroup.LIFESTYLE,0,3,0,0,0,30,"")),traitMap.set(186,new Trait("Game Master",186,"gamer",traitGroup.LIFESTYLE,2,1,0,0,0,0,"")),traitMap.set(66,new Trait("Gardener",66,"gardener",traitGroup.LIFESTYLE,0,0,2,0,1,0,"")),traitMap.set(64,new Trait("Hedonist",64,"hedonist",traitGroup.LIFESTYLE,2,0,0,1,0,0,"")),traitMap.set(70,new Trait("Hunter",70,"hunter",traitGroup.LIFESTYLE,1,2,0,0,0,10,"")),traitMap.set(68,new Trait("Impaler",68,"impaler",traitGroup.LIFESTYLE,0,0,0,2,1,10,"")),traitMap.set(184,new Trait("Master Schemer",184,"schemer",traitGroup.LIFESTYLE,0,0,0,3,0,0,"")),traitMap.set(178,new Trait("Master Seducer",178,"seducer",traitGroup.LIFESTYLE,1,0,0,2,0,0,"")),traitMap.set(179,new Trait("Master Seductress",179,"seductress",traitGroup.LIFESTYLE,1,0,0,2,0,0,"")),traitMap.set(67,new Trait("Mystic",67,"mystic",traitGroup.LIFESTYLE,0,0,1,0,2,0,"")),traitMap.set(65,new Trait("Scholar",65,"scholar",traitGroup.LIFESTYLE,0,0,0,0,3,0,"")),traitMap.set(183,new Trait("Socializer",183,"socializer",traitGroup.LIFESTYLE,3,0,0,0,0,0,"")),traitMap.set(182,new Trait("Strategist",182,"strategist",traitGroup.LIFESTYLE,0,2,1,0,0,0,"")),traitMap.set(185,new Trait("Theologian",185,"theologian",traitGroup.LIFESTYLE,0,0,0,1,2,0,"")),traitMap.set(63,new Trait("Celibate",63,"celibate",traitGroup.LIFESTYLE,0,0,0,0,0,0,"No descendants.")),traitMap.set(72,new Trait("Falconer",72,"falconer",traitGroup.LIFESTYLE,1,0,0,0,0,0,"")),traitMap.set(71,new Trait("Poet",71,"poet",traitGroup.LIFESTYLE,1,0,0,0,0,0,"")),traitMap.set(74,new Trait("Chaste",74,"chaste",traitGroup.PERSONALITY,0,0,0,0,1,0,"")),traitMap.set(76,new Trait("Temperate",76,"temperate",traitGroup.PERSONALITY,0,0,2,0,0,0,"")),traitMap.set(78,new Trait("Charitable",78,"charitable",traitGroup.PERSONALITY,3,0,0,0,0,-3,"")),traitMap.set(80,new Trait("Diligent",80,"diligent",traitGroup.PERSONALITY,1,1,1,1,1,0,"")),traitMap.set(84,new Trait("Patient",84,"patient",traitGroup.PERSONALITY,1,0,1,1,1,5,"")),traitMap.set(82,new Trait("Kind",82,"kind",traitGroup.PERSONALITY,2,0,0,-2,0,-5,"")),traitMap.set(86,new Trait("Humble",86,"humble",traitGroup.PERSONALITY,0,0,0,0,0,0,"")),traitMap.set(73,new Trait("Lustful",73,"lustful",traitGroup.PERSONALITY,0,0,0,1,0,0,"")),traitMap.set(75,new Trait("Gluttonous",75,"gluttonous",traitGroup.PERSONALITY,0,0,-2,0,0,0,"")),traitMap.set(77,new Trait("Greedy",77,"greedy",traitGroup.PERSONALITY,-1,0,0,0,0,0,"")),traitMap.set(79,new Trait("Slothful",79,"slothful",traitGroup.PERSONALITY,-1,-1,-1,-1,-1,-5,"")),traitMap.set(83,new Trait("Wroth",83,"wroth",traitGroup.PERSONALITY,-1,3,0,-1,0,3,"")),traitMap.set(81,new Trait("Envious",81,"envious",traitGroup.PERSONALITY,-1,0,0,2,0,3,"")),traitMap.set(85,new Trait("Proud",85,"proud",traitGroup.PERSONALITY,0,0,0,0,0,0,"")),traitMap.set(93,new Trait("Ambitious",93,"ambitious",traitGroup.PERSONALITY,2,2,2,2,2,3,"")),traitMap.set(95,new Trait("Arbitrary",95,"arbitrary",traitGroup.PERSONALITY,0,0,-2,1,-1,0,"")),traitMap.set(90,new Trait("Brave",90,"brave",traitGroup.PERSONALITY,0,2,0,0,0,10,"")),traitMap.set(94,new Trait("Content",94,"content",traitGroup.PERSONALITY,0,0,0,-1,0,0,"")),traitMap.set(89,new Trait("Craven",89,"craven",traitGroup.PERSONALITY,0,-2,0,0,0,-10,"")),traitMap.set(101,new Trait("Cruel",101,"cruel",traitGroup.PERSONALITY,-1,0,0,1,0,3,"")),traitMap.set(97,new Trait("Cynical",97,"cynical",traitGroup.PERSONALITY,0,0,0,2,0,0,"")),traitMap.set(87,new Trait("Deceitful",87,"deceitful",traitGroup.PERSONALITY,-2,0,0,3,0,3,"")),traitMap.set(188,new Trait("Erudite",188,"erudite",traitGroup.PERSONALITY,0,0,0,0,2,-2,"")),traitMap.set(92,new Trait("Gregarious",92,"gregarious",traitGroup.PERSONALITY,2,0,0,0,0,0,"")),traitMap.set(88,new Trait("Honest",88,"honest",traitGroup.PERSONALITY,3,0,0,-2,0,-2,"")),traitMap.set(96,new Trait("Just",96,"just",traitGroup.PERSONALITY,0,0,2,0,1,0,"")),traitMap.set(99,new Trait("Paranoid",99,"paranoid",traitGroup.PERSONALITY,-1,0,0,2,0,0,"")),traitMap.set(91,new Trait("Shy",91,"shy",traitGroup.PERSONALITY,-2,0,0,0,0,-2,"")),traitMap.set(189,new Trait("Stubborn",189,"stubborn",traitGroup.PERSONALITY,-1,0,1,0,0,3,"")),traitMap.set(100,new Trait("Trusting",100,"trusting",traitGroup.PERSONALITY,1,0,0,-2,0,-2,"")),traitMap.set(98,new Trait("Zealous",98,"zealous",traitGroup.PERSONALITY,0,2,0,0,0,0,"")),traitMap.set(46,new Trait("Kinslayer",46,"kinslayer",traitGroup.KINSLAYER,-5,0,0,0,0,0,"")),traitMap.set(321,new Trait("Familial Kinslayer",321,"familial_kinslayer",traitGroup.KINSLAYER,-4,0,0,0,0,0,"")),traitMap.set(322,new Trait("Dynastic Kinslayer",322,"dynastic_kinslayer",traitGroup.KINSLAYER,-3,0,0,0,0,0,"")),traitMap.set(406,new Trait("Tribal Kinslayer",406,"tribal_kinslayer",traitGroup.KINSLAYER,-3,0,0,0,0,0,"")),traitMap.set(187,new Trait("Adventurer",187,"adventurer",traitGroup.SPECIAL,-1,1,0,0,0,10,"")),traitMap.set(123,new Trait("Blinded",123,"blinded",traitGroup.SPECIAL,0,-6,-2,-2,0,-100,"")),traitMap.set(252,new Trait("Cannibal",252,"cannibal_trait",traitGroup.SPECIAL,0,3,0,0,0,1,"")),traitMap.set(122,new Trait("Eunuch",122,"eunuch",traitGroup.SPECIAL,0,0,0,0,0,0,"Characters with this trait cannot marry, inherit, or be granted landed titles, but can receive a honorary title.")),traitMap.set(45,new Trait("Excommunicated",45,"excommunicated",traitGroup.SPECIAL,-5,0,0,0,0,0,"")),traitMap.set(135,new Trait("Heresiarch",135,"heresiarch",traitGroup.SPECIAL,0,0,0,0,0,3,"")),traitMap.set(47,new Trait("Homosexual",47,"homosexual",traitGroup.SPECIAL,0,0,0,0,0,0,"")),traitMap.set(176,new Trait("In Hiding",176,"in_hiding",traitGroup.SPECIAL,-5,0,0,0,0,0,"")),traitMap.set(173,new Trait("Reincarnation",173,"reincarnation",traitGroup.SPECIAL,0,0,0,0,0,0,"")),traitMap.set(137,new Trait("Varangian",137,"varangian",traitGroup.SPECIAL,1,2,0,0,0,10,"")),traitMap)}function getRacialSTRBonus(e){return e==race.HUMAN?1:e==race.DRAGONBORN?2:e==race.DUERGAR?1:e==race.DWARFMOUNTAIN?2:e==race.HALFORC||e==race.GOLIATH?2:e==race.BUGBEAR?2:e==race.GENASIEARTH?1:e==race.AASIMARFALLEN?1:e==race.FIRBOLG?1:e==race.GOBLIN?1:e==race.KOBOLD?-2:e==race.ORC?2:e==race.TRITON?1:e==race.GITHYANKI?2:0}function getRacialDEXBonus(e){return e==race.HUMAN?1:e==race.DROW||e==race.ELADRIN||e==race.ELFHIGH||e==race.ELFSHADARKAI?2:e==race.GENASIAIR?1:e==race.BUGBEAR?1:e==race.GNOMEDEEP||e==race.GNOMEFOREST?1:e==race.HALFLINGSTOUT||e==race.HALFLINGLIGHTFOOT?2:e==race.HALFELF?1:e==race.AARAKOCRA?2:e==race.GOBLIN?2:e==race.KOBOLD?2:e==race.KENKU?2:e==race.TABAXI?2:0}function getRacialCONBonus(e){return e==race.HUMAN?1:e==race.DUERGAR||e==race.DWARFHILL||e==race.DWARFMOUNTAIN?1:e==race.HALFORC||e==race.GOLIATH?1:e==race.ELFSHADARKAI?1:e==race.GNOMEROCK?1:e==race.HALFLINGSTOUT?1:e==race.GENASIAIR||e==race.GENASIFIRE||e==race.GENASIWATER||e==race.GENASIEARTH?2:e==race.AASIMARSCOURGE?1:e==race.HOBGOBLIN?2:e==race.LIZARDFOLK?2:e==race.ORC?1:e==race.TRITON?1:0}function getRacialINTBonus(e){return e==race.HUMAN?1:e==race.ELFHIGH?1:e==race.GNOMEDEEP||e==race.GNOMEFOREST||e==race.GNOMEROCK?2:e==race.HALFELF?1:e==race.TIEFLING?1:e==race.GENASIFIRE?1:e==race.HOBGOBLIN?1:e==race.ORC?-2:e==race.YUANTI?1:e==race.GITHYANKI||e==race.GITHZERAI?1:0}function getRacialWISBonus(e){return e==race.HUMAN?1:e==race.DWARFHILL?1:e==race.ELFWOOD?1:e==race.AARAKOCRA?1:e==race.GENASIWATER?2:e==race.AASIMARPROTECTOR?1:e==race.FIRBOLG?2:e==race.KENKU?1:e==race.LIZARDFOLK?1:e==race.GITHZERAI?2:0}function getRacialCHABonus(e){return e==race.HUMAN?1:e==race.DRAGONBORN?1:e==race.DROW||e==race.ELADRIN?1:e==race.HALFLINGLIGHTFOOT?1:e==race.HALFELF?2:e==race.TIEFLING?2:e==race.AASIMARPROTECTOR||e==race.AASIMARFALLEN||e==race.AASIMARSCOURGE?2:e==race.TABAXI?1:e==race.TRITON?1:e==race.YUANTI?2:0}function renderProvince(e,t){var a=[new Shape(0,0,0,"province/bg.png",343,446,t)],r=null,i=null;if(e.primaryHolding&&titles.has(e.primaryHolding)){var n=titles.get(e.primaryHolding);if(n.owner>0&&characterMap.has(n.owner)){if(i=characterMap.get(n.owner),a.push(new TextLabel(112,203,100,160,16,getFullName(i),"center","white",!1,t)),(G=getTitleChainUpByLocation(e)).length>0){var s=G[G.length-1][1];if(titles.has(s)){var l=getTitleImages(r=titles.get(s));a.push(new Shape(269,27,3,l[0],44,46,t)),a.push(new Shape(269,27,4,l[1],44,46,t)),provinceMouseOverAreas.push(new MouseOverShape(269,27,313,73,r.name)),a.push(new Shape(284,96,3,l[0],32,34,t)),a.push(new Shape(284,96,4,l[1],32,34,t));var o=getTitleOwner(r);characterMap.has(o)&&provinceClickableAreas.push(new ClickableShape(269,27,313,73,"TitleHolder",makeCharacterRenderFunc(characterMap.get(o)))),provinceMouseOverAreas.push(new MouseOverShape(284,96,316,130,r.name));var h=getCrownImages(r);a.push(new Shape(273,-5,5,h[0],38,39,t)),a.push(new Shape(273,-5,6,h[1],38,39,t))}}if(G.length>2)for(var p=225,c=1;c<G.length-1;c++){var d=G[c][1];if(titles.has(d)){var m=titles.get(d),g=getTitleImages(m);a.push(new Shape(p,33,5,g[0],38,39.7,t)),a.push(new Shape(p,33,6,g[1],38,39.7,t)),provinceMouseOverAreas.push(new MouseOverShape(p,33,p+38,72.7,m.name));var u=getTitleOwner(m);characterMap.has(u)&&provinceClickableAreas.push(new ClickableShape(p,33,p+38,72.7,"TitleHolder",makeCharacterRenderFunc(characterMap.get(u))));h=getCrownImages(m);a.push(new Shape(p+2.5,4.5,7,h[0],32.82,33.68,t)),a.push(new Shape(p+2.5,4.5,8,h[1],32.82,33.68,t)),p+=44}}if(i.strongholdType!=strongholdType.NONE){var f=getStrongholdTypeIcon(i.strongholdType);a.push(new Shape(203,190,5,f,24,24,t))}if(i.strongholdClass!=classType.NONE){f=getStrongholdClassIcon(i.strongholdClass);a.push(new Shape(292,191,5,f,24,24,t))}}a.push(new TextLabel(85,28,100,170,16,n.name,"left","white",!1,t));var _=getHoldingBackgroundImageLarge(n.holdingType);a.push(new Shape(205,100,1,_,108,112,t));var w=getHoldingTypeLargeImage(n.holdingType);a.push(new Shape(213,108,2,w,92,96,t)),provinceMouseOverAreas.push(new MouseOverShape(213,108,305,204,n.name)),null!=i&&provinceClickableAreas.push(new ClickableShape(213,108,305,204,"PrimaryTitleHolder",makeCharacterRenderFunc(i)));var y=getHoldingTitleImages(n);y.length>0&&(a.push(new Shape(10,27,3,y[0],44,46,t)),a.push(new Shape(10,27,4,y[1],44,46,t)),provinceMouseOverAreas.push(new MouseOverShape(10,27,54,73,n.name)),a.push(new Shape(203,96,3,y[0],32,34,t)),a.push(new Shape(203,96,4,y[1],32,34,t)),provinceMouseOverAreas.push(new MouseOverShape(203,96,235,130,n.name)))}var C=0,T=[];T.push([20,233]),T.push([129,233]),T.push([238,233]),T.push([20,340]),T.push([129,340]),T.push([238,340]);var b=[];b.push([28,241]),b.push([137,241]),b.push([246,241]),b.push([28,348]),b.push([137,348]),b.push([246,348]);var v=[];v.push([13,227]),v.push([122,227]),v.push([231,227]),v.push([13,334]),v.push([122,334]),v.push([231,334]);var I=[];I.push([82,227]),I.push([191,227]),I.push([300,227]),I.push([82,334]),I.push([191,334]),I.push([300,334]);for(c=0;c<e.holdings.length;c++){var M=e.holdings[c];if((!e.primaryHolding||e.primaryHolding!=M)&&titles.has(M)){var k=titles.get(M),E=getHoldingBackgroundImageSmall(k.holdingType),A=getHoldingTypeSmallImage(k.holdingType);a.push(new Shape(T[C][0],T[C][1],1,E,85,88,t)),a.push(new Shape(b[C][0],b[C][1],2,A,69,72,t));var L=getHoldingTitleImages(k);if(L&&L.length>0){var S=v[C][0],R=v[C][1],N=32,O=34;a.push(new Shape(S,R,3,L[0],N,O,t)),a.push(new Shape(S,R,4,L[1],N,O,t)),provinceMouseOverAreas.push(new MouseOverShape(S,R,S+N,R+O,k.name))}var G,x=null;if(k.owner>0&&characterMap.has(k.owner)&&(x=characterMap.get(k.owner)),"placeholder"!=k.name){N=(S=b[C][0])+69,O=(R=b[C][1])+72;provinceMouseOverAreas.push(new MouseOverShape(S,R,N,O,k.name)),null!=x&&provinceClickableAreas.push(new ClickableShape(S,R,N,O,"HoldingOwner",makeCharacterRenderFunc(x)))}if(null!=x)if((G=getTitleChainUp(x)).length>0){s=G[G.length-1][1];if(titles.has(s)){l=getTitleImages(r=titles.get(s)),S=I[C][0],R=I[C][1],N=32,O=34;a.push(new Shape(S,R,5,l[0],N,O,t)),a.push(new Shape(S,R,6,l[1],N,O,t)),provinceMouseOverAreas.push(new MouseOverShape(S,R,S+N,R+O,r.name))}}C++}}return provinceMouseOverAreas.sort(function(e,t){return t.minX-e.minX}),provinceClickableAreas.sort(function(e,t){return t.minX-e.minX}),a}var npcClasses=new Map,npcClassIterator=1;function NpcClass(e,t){this.name=e,this.id=t,this.strength=10,this.dexterity=10,this.constitution=10,this.intelligence=10,this.wisdom=10,this.charisma=10,this.armorClass=10}var commoner=new NpcClass("Commoner",npcClassIterator++);commoner.strength=10,commoner.dexterity=10,commoner.constitution=10,commoner.intelligence=10,commoner.wisdom=10,commoner.charisma=10,commoner.armorClass=10,npcClasses.set(commoner.id,commoner);var acolyte=new NpcClass("Acolyte",npcClassIterator++);acolyte.strength=10,acolyte.dexterity=10,acolyte.constitution=10,acolyte.intelligence=10,acolyte.wisdom=14,acolyte.charisma=11,acolyte.armorClass=10,npcClasses.set(acolyte.id,acolyte);var archer=new NpcClass("Archer",npcClassIterator++);archer.strength=11,archer.dexterity=18,archer.constitution=16,archer.intelligence=11,archer.wisdom=13,archer.charisma=10,archer.armorClass=16,npcClasses.set(archer.id,archer);var assassin=new NpcClass("Assassin",npcClassIterator++);assassin.strength=11,assassin.dexterity=16,assassin.constitution=14,assassin.intelligence=13,assassin.wisdom=11,assassin.charisma=10,assassin.armorClass=15,npcClasses.set(assassin.id,assassin);var bandit=new NpcClass("Bandit",npcClassIterator++);bandit.strength=11,bandit.dexterity=12,bandit.constitution=12,bandit.intelligence=10,bandit.wisdom=10,bandit.charisma=10,bandit.armorClass=12,npcClasses.set(bandit.id,bandit);var bdcp=new NpcClass("Bandit Captain",npcClassIterator++);bdcp.strength=15,bdcp.dexterity=16,bdcp.constitution=14,bdcp.intelligence=14,bdcp.wisdom=11,bdcp.charisma=14,bdcp.armorClass=15,npcClasses.set(bdcp.id,bdcp);var bard=new NpcClass("Bard",npcClassIterator++);bard.strength=11,bard.dexterity=14,bard.constitution=12,bard.intelligence=10,bard.wisdom=13,bard.charisma=14,bard.armorClass=15,npcClasses.set(bard.id,bard);var berserker=new NpcClass("Berserker",npcClassIterator++);berserker.strength=16,berserker.dexterity=12,berserker.constitution=17,berserker.intelligence=9,berserker.wisdom=11,berserker.charisma=9,berserker.armorClass=13,npcClasses.set(berserker.id,berserker);var blackguard=new NpcClass("Blackguard",npcClassIterator++);blackguard.strength=18,blackguard.dexterity=11,blackguard.constitution=18,blackguard.intelligence=11,blackguard.wisdom=14,blackguard.charisma=15,blackguard.armorClass=18,npcClasses.set(blackguard.id,blackguard);var chmp=new NpcClass("Champion",npcClassIterator++);chmp.strength=20,chmp.dexterity=15,chmp.constitution=14,chmp.intelligence=10,chmp.wisdom=14,chmp.charisma=12,chmp.armorClass=18,npcClasses.set(chmp.id,chmp);var cltfntc=new NpcClass("Cult Fanatic",npcClassIterator++);cltfntc.strength=11,cltfntc.dexterity=14,cltfntc.constitution=12,cltfntc.intelligence=10,cltfntc.wisdom=13,cltfntc.charisma=14,cltfntc.armorClass=13,npcClasses.set(cltfntc.id,cltfntc);var clt=new NpcClass("Cultist",npcClassIterator++);clt.strength=11,clt.dexterity=12,clt.constitution=10,clt.intelligence=10,clt.wisdom=11,clt.charisma=10,clt.armorClass=12,npcClasses.set(clt.id,clt);var drd=new NpcClass("Druid",npcClassIterator++);drd.strength=10,drd.dexterity=12,drd.constitution=13,drd.intelligence=12,drd.wisdom=15,drd.charisma=11,drd.armorClass=11,npcClasses.set(drd.id,drd);var glad=new NpcClass("Gladiator",npcClassIterator++);glad.strength=18,glad.dexterity=15,glad.constitution=16,glad.intelligence=10,glad.wisdom=12,glad.charisma=15,glad.armorClass=16,npcClasses.set(glad.id,glad);var grd=new NpcClass("Guard",npcClassIterator++);grd.strength=13,grd.dexterity=12,grd.constitution=12,grd.intelligence=10,grd.wisdom=11,grd.charisma=10,grd.armorClass=16,npcClasses.set(grd.id,grd);var knight=new NpcClass("Knight",npcClassIterator++);knight.strength=16,knight.dexterity=11,knight.constitution=14,knight.intelligence=11,knight.wisdom=11,knight.charisma=15,knight.armorClass=18,npcClasses.set(knight.id,knight);var mage=new NpcClass("Mage",npcClassIterator++);mage.strength=9,mage.dexterity=14,mage.constitution=11,mage.intelligence=17,mage.wisdom=12,mage.charisma=11,mage.armorClass=12,npcClasses.set(mage.id,mage);var noble=new NpcClass("Noble",npcClassIterator++);noble.strength=11,noble.dexterity=12,noble.constitution=11,noble.intelligence=12,noble.wisdom=14,noble.charisma=16,noble.armorClass=15,npcClasses.set(noble.id,noble);var priest=new NpcClass("Priest",npcClassIterator++);priest.strength=10,priest.dexterity=10,priest.constitution=12,priest.intelligence=13,priest.wisdom=16,priest.charisma=13,priest.armorClass=13,npcClasses.set(priest.id,priest);var spy=new NpcClass("Spy",npcClassIterator++);spy.strength=10,spy.dexterity=15,spy.constitution=10,spy.intelligence=12,spy.wisdom=14,spy.charisma=16,spy.armorClass=12,npcClasses.set(spy.id,spy);var thug=new NpcClass("Thug",npcClassIterator++);thug.strength=15,thug.dexterity=11,thug.constitution=14,thug.intelligence=10,thug.wisdom=10,thug.charisma=11,thug.armorClass=11,npcClasses.set(thug.id,thug);var trb=new NpcClass("Tribal Warrior",npcClassIterator++);trb.strength=13,trb.dexterity=11,trb.constitution=12,trb.intelligence=8,trb.wisdom=11,trb.charisma=8,trb.armorClass=12,npcClasses.set(trb.id,trb);var vtrn=new NpcClass("Veteran",npcClassIterator++);vtrn.strength=16,vtrn.dexterity=13,vtrn.constitution=14,vtrn.intelligence=10,vtrn.wisdom=11,vtrn.charisma=10,vtrn.armorClass=17,npcClasses.set(vtrn.id,vtrn);var reaver=new NpcClass("Reaver",npcClassIterator++);reaver.strength=18,reaver.dexterity=16,reaver.constitution=16,reaver.intelligence=16,reaver.wisdom=16,reaver.charisma=16,reaver.armorClass=15,npcClasses.set(reaver.id,reaver);var spiritWarden=new NpcClass("Spirit Warden",npcClassIterator++);spiritWarden.strength=18,spiritWarden.dexterity=16,spiritWarden.constitution=16,spiritWarden.intelligence=16,spiritWarden.wisdom=16,spiritWarden.charisma=16,spiritWarden.armorClass=15,npcClasses.set(spiritWarden.id,spiritWarden);var loremaster=new NpcClass("Loremaster",npcClassIterator++);loremaster.strength=16,loremaster.dexterity=16,loremaster.constitution=16,loremaster.intelligence=16,loremaster.wisdom=16,loremaster.charisma=18,loremaster.armorClass=13,npcClasses.set(loremaster.id,loremaster);var troubadour=new NpcClass("Troubadour-warrior",npcClassIterator++);troubadour.strength=16,troubadour.dexterity=16,troubadour.constitution=16,troubadour.intelligence=16,troubadour.wisdom=16,troubadour.charisma=18,troubadour.armorClass=13,npcClasses.set(troubadour.id,troubadour);var curate=new NpcClass("Curate",npcClassIterator++);curate.strength=16,curate.dexterity=16,curate.constitution=16,curate.intelligence=16,curate.wisdom=18,curate.charisma=16,curate.armorClass=15,npcClasses.set(curate.id,curate);var exorcist=new NpcClass("Exorcist",npcClassIterator++);exorcist.strength=16,exorcist.dexterity=16,exorcist.constitution=16,exorcist.intelligence=16,exorcist.wisdom=18,exorcist.charisma=16,exorcist.armorClass=15,npcClasses.set(exorcist.id,exorcist);var healer=new NpcClass("Healer",npcClassIterator++);healer.strength=16,healer.dexterity=16,healer.constitution=16,healer.intelligence=16,healer.wisdom=18,healer.charisma=16,healer.armorClass=18,npcClasses.set(healer.id,healer);var shadowPriest=new NpcClass("Shadow Priest",npcClassIterator++);shadowPriest.strength=16,shadowPriest.dexterity=16,shadowPriest.constitution=16,shadowPriest.intelligence=16,shadowPriest.wisdom=18,shadowPriest.charisma=16,shadowPriest.armorClass=15,npcClasses.set(shadowPriest.id,shadowPriest);var stormspeaker=new NpcClass("Stormspeaker",npcClassIterator++);stormspeaker.strength=16,stormspeaker.dexterity=16,stormspeaker.constitution=16,stormspeaker.intelligence=16,stormspeaker.wisdom=18,stormspeaker.charisma=16,stormspeaker.armorClass=18,npcClasses.set(stormspeaker.id,stormspeaker);var warden=new NpcClass("Warden",npcClassIterator++);warden.strength=16,warden.dexterity=16,warden.constitution=16,warden.intelligence=16,warden.wisdom=18,warden.charisma=16,warden.armorClass=15,npcClasses.set(warden.id,warden);var battlePriest=new NpcClass("Battle Priest",npcClassIterator++);battlePriest.strength=16,battlePriest.dexterity=16,battlePriest.constitution=16,battlePriest.intelligence=16,battlePriest.wisdom=18,battlePriest.charisma=16,battlePriest.armorClass=18,npcClasses.set(battlePriest.id,battlePriest);var mystic=new NpcClass("Mystic",npcClassIterator++);mystic.strength=16,mystic.dexterity=16,mystic.constitution=16,mystic.intelligence=16,mystic.wisdom=18,mystic.charisma=16,mystic.armorClass=15,npcClasses.set(mystic.id,mystic);var skinwalker=new NpcClass("Skinwalker",npcClassIterator++);skinwalker.strength=16,skinwalker.dexterity=16,skinwalker.constitution=16,skinwalker.intelligence=16,skinwalker.wisdom=18,skinwalker.charisma=16,skinwalker.armorClass=15,npcClasses.set(skinwalker.id,skinwalker);var knightSorcerer=new NpcClass("Knight-Sorcerer",npcClassIterator++);knightSorcerer.strength=18,knightSorcerer.dexterity=16,knightSorcerer.constitution=16,knightSorcerer.intelligence=16,knightSorcerer.wisdom=16,knightSorcerer.charisma=16,knightSorcerer.armorClass=18,npcClasses.set(knightSorcerer.id,knightSorcerer);var swordmaster=new NpcClass("Swordmaster",npcClassIterator++);swordmaster.strength=18,swordmaster.dexterity=16,swordmaster.constitution=16,swordmaster.intelligence=16,swordmaster.wisdom=16,swordmaster.charisma=16,swordmaster.armorClass=18,npcClasses.set(swordmaster.id,swordmaster);var warlord=new NpcClass("Warlord",npcClassIterator++);warlord.strength=18,warlord.dexterity=16,warlord.constitution=16,warlord.intelligence=16,warlord.wisdom=16,warlord.charisma=16,warlord.armorClass=18,npcClasses.set(warlord.id,warlord);var acolyteWay=new NpcClass("Acolyte of the Way",npcClassIterator++);acolyteWay.strength=16,acolyteWay.dexterity=18,acolyteWay.constitution=16,acolyteWay.intelligence=16,acolyteWay.wisdom=18,acolyteWay.charisma=16,acolyteWay.armorClass=15,npcClasses.set(acolyteWay.id,acolyteWay);var acolyteDarkness=new NpcClass("Acolyte of Darkness",npcClassIterator++);acolyteDarkness.strength=16,acolyteDarkness.dexterity=18,acolyteDarkness.constitution=16,acolyteDarkness.intelligence=16,acolyteDarkness.wisdom=18,acolyteDarkness.charisma=16,acolyteDarkness.armorClass=15,npcClasses.set(acolyteDarkness.id,acolyteDarkness);var elementalAcolyte=new NpcClass("Elemental Acolyte",npcClassIterator++);elementalAcolyte.strength=16,elementalAcolyte.dexterity=18,elementalAcolyte.constitution=16,elementalAcolyte.intelligence=16,elementalAcolyte.wisdom=18,elementalAcolyte.charisma=16,elementalAcolyte.armorClass=15,npcClasses.set(elementalAcolyte.id,elementalAcolyte);var cavalier=new NpcClass("Cavalier",npcClassIterator++);cavalier.strength=18,cavalier.dexterity=16,cavalier.constitution=16,cavalier.intelligence=16,cavalier.wisdom=16,cavalier.charisma=18,cavalier.armorClass=18,npcClasses.set(cavalier.id,cavalier);var justicar=new NpcClass("Justicar",npcClassIterator++);justicar.strength=18,justicar.dexterity=16,justicar.constitution=16,justicar.intelligence=16,justicar.wisdom=16,justicar.charisma=18,justicar.armorClass=18,npcClasses.set(justicar.id,justicar);var greenOrderKnight=new NpcClass("Knight of the Green Order",npcClassIterator++);greenOrderKnight.strength=18,greenOrderKnight.dexterity=16,greenOrderKnight.constitution=16,greenOrderKnight.intelligence=16,greenOrderKnight.wisdom=16,greenOrderKnight.charisma=18,greenOrderKnight.armorClass=18,npcClasses.set(greenOrderKnight.id,greenOrderKnight);var beastLord=new NpcClass("Beast Lord",npcClassIterator++);beastLord.strength=16,beastLord.dexterity=18,beastLord.constitution=16,beastLord.intelligence=16,beastLord.wisdom=18,beastLord.charisma=16,beastLord.armorClass=15,npcClasses.set(beastLord.id,beastLord);var tracker=new NpcClass("Tracker",npcClassIterator++);tracker.strength=16,tracker.dexterity=18,tracker.constitution=16,tracker.intelligence=16,tracker.wisdom=18,tracker.charisma=16,tracker.armorClass=15,npcClasses.set(tracker.id,tracker);var executioner=new NpcClass("Executioner",npcClassIterator++);executioner.strength=16,executioner.dexterity=18,executioner.constitution=16,executioner.intelligence=16,executioner.wisdom=16,executioner.charisma=16,executioner.armorClass=13,npcClasses.set(executioner.id,executioner);var guildAdept=new NpcClass("Guild Adept",npcClassIterator++);guildAdept.strength=16,guildAdept.dexterity=18,guildAdept.constitution=16,guildAdept.intelligence=16,guildAdept.wisdom=16,guildAdept.charisma=16,guildAdept.armorClass=13,npcClasses.set(guildAdept.id,guildAdept);var cutpurse=new NpcClass("Cutpurse",npcClassIterator++);cutpurse.strength=16,cutpurse.dexterity=18,cutpurse.constitution=16,cutpurse.intelligence=16,cutpurse.wisdom=16,cutpurse.charisma=16,cutpurse.armorClass=13,npcClasses.set(cutpurse.id,cutpurse);var thaumaturgist=new NpcClass("Thaumaturgist",npcClassIterator++);thaumaturgist.strength=16,thaumaturgist.dexterity=16,thaumaturgist.constitution=16,thaumaturgist.intelligence=16,thaumaturgist.wisdom=16,thaumaturgist.charisma=18,thaumaturgist.armorClass=13,npcClasses.set(thaumaturgist.id,thaumaturgist);var chaosMage=new NpcClass("Chaos Mage",npcClassIterator++);chaosMage.strength=16,chaosMage.dexterity=16,chaosMage.constitution=16,chaosMage.intelligence=16,chaosMage.wisdom=16,chaosMage.charisma=18,chaosMage.armorClass=13,npcClasses.set(chaosMage.id,chaosMage);var alienist=new NpcClass("Alienist",npcClassIterator++);alienist.strength=16,alienist.dexterity=16,alienist.constitution=16,alienist.intelligence=16,alienist.wisdom=16,alienist.charisma=18,alienist.armorClass=13,npcClasses.set(alienist.id,alienist);var diabolist=new NpcClass("Diabolist",npcClassIterator++);diabolist.strength=16,diabolist.dexterity=16,diabolist.constitution=16,diabolist.intelligence=16,diabolist.wisdom=16,diabolist.charisma=18,diabolist.armorClass=13,npcClasses.set(diabolist.id,diabolist);var exarch=new NpcClass("Exarch",npcClassIterator++);exarch.strength=16,exarch.dexterity=16,exarch.constitution=16,exarch.intelligence=16,exarch.wisdom=16,exarch.charisma=18,exarch.armorClass=13,npcClasses.set(exarch.id,exarch);var conjurer=new NpcClass("Conjurer",npcClassIterator++);conjurer.strength=16,conjurer.dexterity=16,conjurer.constitution=16,conjurer.intelligence=18,conjurer.wisdom=16,conjurer.charisma=16,conjurer.armorClass=13,npcClasses.set(conjurer.id,conjurer);var enchanter=new NpcClass("Enchanter",npcClassIterator++);enchanter.strength=16,enchanter.dexterity=16,enchanter.constitution=16,enchanter.intelligence=18,enchanter.wisdom=16,enchanter.charisma=16,enchanter.armorClass=13,npcClasses.set(enchanter.id,enchanter);var evoker=new NpcClass("Evoker",npcClassIterator++);evoker.strength=16,evoker.dexterity=16,evoker.constitution=16,evoker.intelligence=18,evoker.wisdom=16,evoker.charisma=16,evoker.armorClass=13,npcClasses.set(evoker.id,evoker);var illusionist=new NpcClass("Illusionist",npcClassIterator++);illusionist.strength=16,illusionist.dexterity=16,illusionist.constitution=16,illusionist.intelligence=18,illusionist.wisdom=16,illusionist.charisma=16,illusionist.armorClass=13,npcClasses.set(illusionist.id,illusionist);var necromancer=new NpcClass("Necromancer",npcClassIterator++);necromancer.strength=16,necromancer.dexterity=16,necromancer.constitution=16,necromancer.intelligence=18,necromancer.wisdom=16,necromancer.charisma=16,necromancer.armorClass=13,npcClasses.set(necromancer.id,necromancer);var seer=new NpcClass("Seer",npcClassIterator++);seer.strength=16,seer.dexterity=16,seer.constitution=16,seer.intelligence=18,seer.wisdom=16,seer.charisma=16,seer.armorClass=13,npcClasses.set(seer.id,seer);var shaper=new NpcClass("Shaper",npcClassIterator++);shaper.strength=16,shaper.dexterity=16,shaper.constitution=16,shaper.intelligence=18,shaper.wisdom=16,shaper.charisma=16,shaper.armorClass=13,npcClasses.set(shaper.id,shaper);var theurgist=new NpcClass("Theurgist",npcClassIterator++);function DataSaver(e,t,a){this.houses=[...e],this.titles=[...t],this.characters=[...a]}function DataLoader(){this.houses=new Map,this.titles=new Map,this.characters=new Map}function LandedTitle(e,t){this.name=e,this.id=t,this.mapData=null,this.WikiUrl=""}function County(e,t){LandedTitle.call(this,e,t),this.primaryHolding=0,this.holdings=[],this.parent=0,this.titleImportance=2}function Holding(e,t,a){LandedTitle.call(this,e,t),this.holdingType=a,this.parent=0,this.owner=0,this.titleImportance=1}function Duchy(e,t){LandedTitle.call(this,e,t),this.parent=0,this.owner=0,this.counties=[],this.titleImportance=3}function Kingdom(e,t){LandedTitle.call(this,e,t),this.parent=0,this.owner=0,this.duchies=[],this.counties=[],this.titleImportance=4}function Empire(e,t){LandedTitle.call(this,e,t),this.parent=0,this.owner=0,this.kingdoms=[],this.duchies=[],this.counties=[],this.titleImportance=5}function Council(e){this.liege=e,this.chancellor=0,this.marshal=0,this.steward=0,this.spymaster=0,this.chaplain=0}function getDirectVassalTitles(e){var t=[];for(var[a,r]of titles.entries())r.parent==e.id&&t.push(r.id);return t}function titleSanityCheck(e){if(2==e.titleImportance){if(0==e.primaryHolding&&e.holdings.length>0&&(e.primaryHolding=e.holdings[0]),titles.has(e.primaryHolding)){var t=titles.get(e.primaryHolding);t.owner>0&&(characterMap.has(t.owner)&&characterMap.get(t.owner).alive||(t.owner=0))}}else e.owner>0&&(characterMap.has(e.owner)&&characterMap.get(e.owner).alive||(e.owner=0));return!1}function getTitleChainUpByLocation(e){var t=[],a=getTitleOwner(e);if(0==a)return t;for(var r=characterMap.get(a),i=e.id;r&&i>0;)if(t.push([r.id,i]),titles.has(i)){var n=titles.get(i);if(0==n.parent)r=null,i=0;else{i=n.parent;var s=getTitleOwner(titles.get(n.parent));r=characterMap.get(s)}}return t}function setTitleOwner(e,t){2==e.titleImportance?(0==e.primaryHolding&&e.holdings.length>0&&(e.primaryHolding=e.holdings[0]),titles.has(e.primaryHolding)&&(titles.get(e.primaryHolding).owner=t)):e.owner=t}function getTitleOwner(e){return 2!=e.titleImportance?e.owner:(0==e.primaryHolding&&e.holdings.length>0&&(e.primaryHolding=e.holdings[0]),titles.has(e.primaryHolding)?titles.get(e.primaryHolding).owner:void 0)}function getVassalTitles(e){var t=[];if(1==e.titleImportance)return t;if(2==e.titleImportance&&(t=t.concat(e.holdings)),e.titleImportance>2){for(var a=0;a<e.counties.length;a++)t=t.concat(e.counties[a].holdings);t=t.concat(e.counties)}return e.titleImportance>3&&(t=t.concat(e.duchies)),e.titleImportance>4&&(t=t.concat(e.kingdoms)),t}function House(e,t){this.id=t,this.name=e,this.members=[],this.emblem=0}function Pact(e,t,a){this.id=e,this.type=t,this.characters=a}function getTitleByName(e){for(var[t,a]of titles.entries())if(a.name==e)return t;return 0}function getTitleType(e){return 5==e.titleImportance?titleTypes.EMPIRE:4==e.titleImportance?titleTypes.KINGDOM:3==e.titleImportance?titleTypes.DUCHY:2==e.titleImportance?titleTypes.COUNTY:titleTypes.HOLDING}function getCrownImages(e){var t="profile/crowns/";return 5==e.titleImportance?[t+"emperor_bg.png",t+"emperor.png"]:4==e.titleImportance?[t+"king_bg.png",t+"king.png"]:3==e.titleImportance?[t+"duke_bg.png",t+"duke.png"]:2==e.titleImportance?[t+"count_bg.png",t+"count.png"]:[t+"baron_bg.png",t+"baron.png"]}function getTitleImages(e){var t=[];if(t.push("profile/shield_bg.png"),2==e.titleImportance&&e.primaryHolding&&titles.has(e.primaryHolding)){var a=titles.get(e.primaryHolding),r=""!=a.name?a.name.toLowerCase().replace(/ /g,"_"):a.id;return t.push("provinces/"+r+".png"),t}r=""!=e.name?e.name.toLowerCase().replace(/ /g,"_"):e.id;return 3==e.titleImportance&&(r="d_"+r),t.push("provinces/"+r+".png"),t}function getTitleMouseOverText(e){if(5==e.titleImportance)return"Empire of "+e.name;if(4==e.titleImportance)return"Kingdom of "+e.name;if(3==e.titleImportance)return"Duchy of "+e.name;if(2==e.titleImportance)return e.primaryHolding>0&&titles.has(e.primaryHolding)?"County of "+titles.get(e.primaryHolding).name:e.holdings.length>0?"County of "+titles.get(e.holdings[0]).name:"County of "+e.name;if(1==e.titleImportance){if(e.holdingType==holdingtypes.CASTLE)return"Barony of "+e.name;if(e.holdingType==holdingtypes.CITY)return"City of "+e.name;if(e.holdingType==holdingtypes.TEMPLE)return"Bishopric of "+e.name;if(e.holdingType==holdingtypes.FORT)return"Fort "+e.name;if(e.holdingType==holdingtypes.TRADE)return"Port "+e.name}return"Barony of "+e.name}function getHoldingTitleImages(e){return e.holdingType==holdingtypes.EMPTY||e.holdingType==holdingtypes.FORT||e.holdingType==holdingtypes.TRADE?null:getTitleImages(e)}function getHouseImage(e){return"houses/"+e.name.toLowerCase().replace(" ","_")+".png"}function getHoldingTypePreviewImage(e){var t="empty";return e==holdingtypes.CASTLE?t="castle":e==holdingtypes.CITY?t="city":e==holdingtypes.TEMPLE?t="temple":e==holdingtypes.FORT?t="fort":e==holdingtypes.TRADE&&(t="trade"),"holdingTypes/"+t+".png"}function getHoldingTypeLargeImage(e){var t="Empty";return e==holdingtypes.CASTLE?t="Castle":e==holdingtypes.CITY?t="City":e==holdingtypes.TEMPLE?t="Temple":e==holdingtypes.FORT?t="Fort":e==holdingtypes.TRADE&&(t="TradePost"),"province/holding"+t+"Large.png"}function getHoldingBackgroundImageLarge(e){var t="Empty";return e==holdingtypes.CASTLE?t="Castle":e==holdingtypes.CITY?t="City":e==holdingtypes.TEMPLE?t="Temple":e==holdingtypes.FORT?t="Fort":e==holdingtypes.TRADE&&(t="TradePost"),"province/holdingBgLarge"+t+".png"}function getHoldingBackgroundImageSmall(e){var t="Empty";return e==holdingtypes.CASTLE?t="Castle":e==holdingtypes.CITY?t="City":e==holdingtypes.TEMPLE?t="Temple":e==holdingtypes.FORT?t="Fort":e==holdingtypes.TRADE&&(t="TradePost"),"province/holdingBgSmall"+t+".png"}function getHoldingTypeSmallImage(e){var t="Empty";return e==holdingtypes.CASTLE?t="Castle":e==holdingtypes.CITY?t="City":e==holdingtypes.TEMPLE?t="Temple":e==holdingtypes.FORT?t="Fort":e==holdingtypes.TRADE&&(t="TradePost"),"province/holding"+t+"Small.png"}theurgist.strength=16,theurgist.dexterity=16,theurgist.constitution=16,theurgist.intelligence=18,theurgist.wisdom=16,theurgist.charisma=16,theurgist.armorClass=13,npcClasses.set(theurgist.id,theurgist),County.prototype=Object.create(LandedTitle.prototype),Duchy.prototype=Object.create(LandedTitle.prototype),Kingdom.prototype=Object.create(LandedTitle.prototype),Empire.prototype=Object.create(LandedTitle.prototype),Council.prototype.exists=function(){return this.chancellor>0||this.marshal>0||this.steward>0||this.spymaster>0||this.chaplain>0},Council.prototype.clear=function(){this.chancellor=0,this.marshal=0,this.steward=0,this.spymaster=0,this.chaplain=0},Pact.prototype.getOtherCharacter=function(e){for(var t=0;t<this.characters.length;t++)if(this.characters[t]!=e)return this.characters[t];return 0},Pact.prototype.getTypeIndex=function(){return this.type==pactType.NAP?7:this.type==pactType.ALLIANCE?0:this.type==pactType.DEFP?4:this.type==pactType.TRUCE?1:this.type==pactType.EMBARGO?5:this.type==pactType.TRADE?6:3},Pact.prototype.getDescription=function(){return this.characters.length>1?this.type+" between "+getFullName(characterMap.get(this.characters[0]))+" and "+getFullName(characterMap.get(this.characters[1])):this.type},Pact.prototype.getImageUrl=function(){var e="profile/diplomacy/";return this.type==pactType.NAP?e+"d8.png":this.type==pactType.ALLIANCE?e+"d1.png":this.type==pactType.DEFP?e+"d5.png":this.type==pactType.TRUCE?e+"d2.png":this.type==pactType.EMBARGO?e+"d6.png":this.type==pactType.TRADE?e+"d7.png":e+"d4.png"};var pactIterator=1,pacts=new Map,houseIterator=1,houses=new Map,titleIterator=1,titles=new Map,currentTitle=0,characterIterator=1,characterMap=new Map,currentCharacter=0;function MapData(e,t){this.name=e,this.title=t,this.position=[0,0],this.boundaryShape=[],this.strokeOpacity=1,this.strokeColor="white",this.fillOpacity=.4,this.fillColor="black",this.group="",this.stackSize=1,this.imageUrl="",this.useTitleInfo=!1}MapData.prototype.IsMarker=function(){return 0!=this.position[0]||0!=this.position[1]},MapData.prototype.GetMarkerPosition=function(){return getPos(this.position[0],this.position[1])},MapData.prototype.IsPolygon=function(){return this.boundaryShape.length>0},MapData.prototype.GetImageUrl=function(){return this.hasOwnProperty("imageUrl")?this.imageUrl:""},MapData.prototype.UseTitleInfo=function(){return!!this.hasOwnProperty("useTitleInfo")&&this.useTitleInfo},MapData.prototype.GetBoundaryPositions=function(){if(this.hasOwnProperty("stackSize")&&this.stackSize>1){for(var e=[],t=0;t<this.boundaryShape.length;t++)e.push(this.GetBoundaryPositionsFromPositionArray(this.boundaryShape[t]));return e}return this.GetBoundaryPositionsFromPositionArray(this.boundaryShape)},MapData.prototype.GetBoundaryPositionsFromPositionArray=function(e){for(var t=[],a=0;a<e.length;a++)t.push(getPos(e[a][0],e[a][1]));return t};const holdingtypes={CASTLE:"Castle",TEMPLE:"Temple",CITY:"City",FORT:"Fort",TRADE:"Trade Post",EMPTY:"Empty"},titleTypes={COUNTY:"County",DUCHY:"Duchy",KINGDOM:"Kingdom",EMPIRE:"Empire",HOLDING:"Holding"},alignments={CG:"Chaotic Good",NG:"Neutral Good",LG:"Lawful Good",CN:"Chaotic Neutral",N:"Neutral",LN:"Lawful Neutral",CE:"Chaotic Evil",NE:"Neutral Evil",LE:"Lawful Evil"},gender={MALE:"Male",FEMALE:"Female",OTHER:"Other"},strongholdType={NONE:"None",ESTABLISHMENT:"Establishment",KEEP:"Keep",TEMPLE:"Temple",TOWER:"Tower"},classType={NONE:"None",BARBARIAN:"Barbarian",BARD:"Bard",CLERIC:"Cleric",DRUID:"Druid",FIGHTER:"Fighter",MONK:"Monk",PALADIN:"Paladin",RANGER:"Ranger",ROGUE:"Rogue",SORCERER:"Sorcerer",WARLOCK:"Warlock",WIZARD:"Wizard"},pactType={NAP:"Non-Aggression Pact",ALLIANCE:"Alliance",DEFP:"Defensive Pact",TRUCE:"Truce",EMBARGO:"Embargo",TRADE:"Trade Agreement",PEACE:"Peace Treaty"};var pactTypes=[pactType.NAP,pactType.ALLIANCE,pactType.DEFP,pactType.TRUCE,pactType.EMBARGO,pactType.TRADE,pactType.PEACE];const race={HUMAN:"Human",HALFELF:"Half-Elf",ELFHIGH:"High Elf",ELFWOOD:"Wood Elf",ELFSHADARKAI:"Shadar-Kai",HALFLINGSTOUT:"Stout Halfling",HALFLINGLIGHTFOOT:"Lightfoot Halfling",GNOMEFOREST:"Forest Gnome",GNOMEDEEP:"Deep Gnome",GNOMEROCK:"Rock Gnome",DWARFMOUNTAIN:"Mountain Dwarf",DWARFHILL:"Hill Dwarf",DUERGAR:"Duergar",HALFORC:"Half-Orc",DRAGONBORN:"Dragonborn",TIEFLING:"Tiefling",ORC:"Orc",KOBOLD:"Kobold",LIZARDFOLK:"Lizardfolk",GOBLIN:"Goblin",HOBGOBLIN:"Hobgoblin",FIRBOLG:"Firbolg",BUGBEAR:"Bugbear",TABAXI:"Tabaxi",DROW:"Drow",TRITON:"Triton",AARAKOCRA:"Aarakocra",GENASIAIR:"Air Genasi",GENASIEARTH:"Earth Genasi",GENASIWATER:"Water Genasi",GENASIFIRE:"Fire Genasi",GOLIATH:"Goliath",ELADRIN:"Eladrin",KENKU:"Kenku",AASIMARFALLEN:"Fallen Aasimar",AASIMARPROTECTOR:"Protector Aasimar",AASIMARSCOURGE:"Scourge Aasimar",YUANTI:"Yuan-Ti Pureblood",GITHYANKI:"Githyanki",GITHZERAI:"Githzerai"};var councilVisible=!1;function drawCouncil(e,t,a,r,i,n,s){if(councilVisible||t){clearCanvasFromPoint(n,549,0),councilVisible=!1;for(var l=[],o=0;o<profileClickableAreas.length;o++)"CouncilMember"!=profileClickableAreas[o].description&&l.push(profileClickableAreas[o]);profileClickableAreas=l;var h=[];for(o=0;o<profileMouseOverAreas.length;o++)profileMouseOverAreas[o].minX<549&&h.push(profileMouseOverAreas[o]);profileMouseOverAreas=h}else{var p=[0,128,256,384,512];positionIterator=0,councilVisible=!0;var c=new RenderStack;if(e.chancellor>0){var d=characterMap.get(e.chancellor);if(c.addElement(new Shape(549,p[positionIterator],0,"council/frame.png",126,128,n)),c.addElement(new Shape(549,p[positionIterator]+2,1e3,"council/banner.png",126,128,n)),a){c.addElement(new Shape(549,p[positionIterator],500,"council/bg_number.png",126,128,n));var m=d.getCK2Stats();c.addElement(new TextLabel(660,p[positionIterator]+22,1500,100,18,m[0],"right","white",!0,n,!0))}clearCanvas("council1"),c.addElements(renderCharacterPortrait(d,[0,0,0],"council1",!1,!0)),c.addElement(new RenderedImage(552,p[positionIterator]+3,300,120,120,"council1",n)),c.addElement(new TextLabel(615,p[positionIterator]+110,1600,110,18,"Chancellor","center","black",!0,n,!0)),profileMouseOverAreas.push(new MouseOverShape(549,p[positionIterator],675,p[positionIterator]+128,getFullNameWithPrimaryTitleLocation(d))),profileClickableAreas.push(new ClickableShape(549,p[positionIterator],675,p[positionIterator]+128,"CouncilMember",makeCharacterRenderFunc(d))),positionIterator++}if(e.marshal>0){var g=characterMap.get(e.marshal);if(c.addElement(new Shape(549,p[positionIterator],0,"council/frame.png",126,128,n)),c.addElement(new Shape(549,p[positionIterator]+2,1e3,"council/banner.png",126,128,n)),a){c.addElement(new Shape(549,p[positionIterator],500,"council/bg_number.png",126,128,n));m=g.getCK2Stats();c.addElement(new TextLabel(660,p[positionIterator]+22,1500,100,18,m[1],"right","white",!0,n,!0))}clearCanvas("council2"),c.addElements(renderCharacterPortrait(g,[0,0,0],"council2",!1,!0)),c.addElement(new RenderedImage(552,p[positionIterator]+3,300,120,120,"council2",n)),c.addElement(new TextLabel(615,p[positionIterator]+110,1600,110,18,"Marshal","center","black",!0,n,!0)),profileMouseOverAreas.push(new MouseOverShape(549,p[positionIterator],675,p[positionIterator]+128,getFullNameWithPrimaryTitleLocation(g))),profileClickableAreas.push(new ClickableShape(549,p[positionIterator],675,p[positionIterator]+128,"CouncilMember",makeCharacterRenderFunc(g))),positionIterator++}if(e.steward>0){var u=characterMap.get(e.steward);if(c.addElement(new Shape(549,p[positionIterator],0,"council/frame.png",126,128,n)),c.addElement(new Shape(549,p[positionIterator]+2,1e3,"council/banner.png",126,128,n)),a){c.addElement(new Shape(549,p[positionIterator],500,"council/bg_number.png",126,128,n));m=u.getCK2Stats();c.addElement(new TextLabel(660,p[positionIterator]+22,1500,100,18,m[2],"right","white",!0,n,!0))}clearCanvas("council3"),c.addElements(renderCharacterPortrait(u,[0,0,0],"council3",!1,!0)),c.addElement(new RenderedImage(552,p[positionIterator]+3,300,120,120,"council3",n)),c.addElement(new TextLabel(615,p[positionIterator]+110,1600,110,18,"Steward","center","black",!0,n,!0)),profileMouseOverAreas.push(new MouseOverShape(549,p[positionIterator],675,p[positionIterator]+128,getFullNameWithPrimaryTitleLocation(u))),profileClickableAreas.push(new ClickableShape(549,p[positionIterator],675,p[positionIterator]+128,"CouncilMember",makeCharacterRenderFunc(u))),positionIterator++}if(e.spymaster>0){var f=characterMap.get(e.spymaster);if(c.addElement(new Shape(549,p[positionIterator],0,"council/frame.png",126,128,n)),c.addElement(new Shape(549,p[positionIterator]+2,1e3,"council/banner.png",126,128,n)),a){c.addElement(new Shape(549,p[positionIterator],500,"council/bg_number.png",126,128,n));m=f.getCK2Stats();c.addElement(new TextLabel(660,p[positionIterator]+22,1500,100,18,m[3],"right","white",!0,n,!0))}clearCanvas("council4"),c.addElements(renderCharacterPortrait(f,[0,0,0],"council4",!1,!0)),c.addElement(new RenderedImage(552,p[positionIterator]+3,300,120,120,"council4",n)),c.addElement(new TextLabel(615,p[positionIterator]+110,1600,110,18,"Spymaster","center","black",!0,n,!0)),profileMouseOverAreas.push(new MouseOverShape(549,p[positionIterator],675,p[positionIterator]+128,getFullNameWithPrimaryTitleLocation(f))),profileClickableAreas.push(new ClickableShape(549,p[positionIterator],675,p[positionIterator]+128,"CouncilMember",makeCharacterRenderFunc(f))),positionIterator++}if(e.chaplain>0){var _=characterMap.get(e.chaplain);if(c.addElement(new Shape(549,p[positionIterator],0,"council/frame.png",126,128,n)),c.addElement(new Shape(549,p[positionIterator]+2,1e3,"council/banner.png",126,128,n)),a){c.addElement(new Shape(549,p[positionIterator],500,"council/bg_number.png",126,128,n));m=_.getCK2Stats();c.addElement(new TextLabel(660,p[positionIterator]+22,1500,100,18,m[4],"right","white",!0,n,!0))}clearCanvas("council5"),c.addElements(renderCharacterPortrait(_,[0,0,0],"council5",!1,!0)),c.addElement(new RenderedImage(552,p[positionIterator]+3,300,120,120,"council5",n)),c.addElement(new TextLabel(615,p[positionIterator]+110,1600,110,18,"Court Chaplain","center","black",!0,n,!0)),profileMouseOverAreas.push(new MouseOverShape(549,p[positionIterator],675,p[positionIterator]+128,getFullNameWithPrimaryTitleLocation(_))),profileClickableAreas.push(new ClickableShape(549,p[positionIterator],675,p[positionIterator]+128,"CouncilMember",makeCharacterRenderFunc(_))),positionIterator++}minMaxClickableProfileBounds=getMinMaxBounds(profileClickableAreas),minMaxProfileBounds=getMinMaxBounds(profileMouseOverAreas),profileMouseOverAreas.sort(function(e,t){return t.minX-e.minX}),profileClickableAreas.sort(function(e,t){return t.minX-e.minX}),loadRenderStack(c)}}function clearEvents(e,t,a){var r=document.getElementById(e);t&&r.removeEventListener("click",t,!0),a&&r.removeEventListener("mousemove",a,!1),t=null,a=null}function renderCharacter(e,t,a,r,i){clearCanvas(r);for(var n=0;n<i.length;n++)clearCanvas(i[n]);clearEvents(r,profileClicker,profileMover),profileMouseOverAreas=[],profileClickableAreas=[],a.clear();var s=[[]],l=0;drawCouncil(null,!0,!1,t,a,r,i);var o=GetTraits();s[0].push(new Shape(t[0],t[1],t[2]+1,"profile/bg.png",549,693,r));var h=getFullNameWithPrimaryTitleLocation(e);s[0].push(new TextLabel(t[0]+20,t[1]+30,t[2]+3,500,16,h,"left","black",!0,r)),s[0].push(new TextLabel(t[0]+444,t[1]+72,t[2]+4,300,20,e.age,"left","black",!0,r)),s[0].push(new TextLabel(t[0]+507,t[1]+72,t[2]+5,300,20,e.dndattributes.armorClass,"left","black",!0,r));var p=e.getDndStats();if(s[0].push(new TextLabel(t[0]+488,t[1]+99,t[2]+6,100,18,p[0],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+488,t[1]+121,t[2]+6,100,18,p[1],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+488,t[1]+143,t[2]+6,100,18,p[2],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+488,t[1]+167,t[2]+6,100,18,p[3],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+488,t[1]+190,t[2]+6,100,18,p[4],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+488,t[1]+214,t[2]+6,100,18,p[5],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+525,t[1]+97,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+119,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+141,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+165,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+188,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+212,t[2]+7,100,17,"(     )","right","black",!1,r)),s[0].push(new TextLabel(t[0]+518,t[1]+99,t[2]+8,100,18,p[6],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+518,t[1]+121,t[2]+8,100,18,p[7],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+518,t[1]+143,t[2]+8,100,18,p[8],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+518,t[1]+167,t[2]+8,100,18,p[9],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+518,t[1]+190,t[2]+8,100,18,p[10],"right","black",!0,r)),s[0].push(new TextLabel(t[0]+518,t[1]+214,t[2]+8,100,18,p[11],"right","black",!0,r)),e.spouse>0&&characterMap.has(e.spouse)){var c=characterMap.get(e.spouse);s[0].push(new Shape(t[0]+210,t[1]+117,t[2]+2,"profile/bg_spouse.png",120,132,r)),s.push(renderCharacterPortrait(c,[0,0,0],i[l],!1,!1)),s.push(new RenderedImage(201,115,400,133,133,i[l],r)),l++,profileMouseOverAreas.push(new MouseOverShape(t[0]+201,t[1]+115,t[0]+201+133,t[1]+115+133,getFullNameWithPrimaryTitleLocation(c))),profileClickableAreas.push(new ClickableShape(t[0]+201,t[1]+115,t[0]+201+133,t[1]+115+133,"Spouse",makeCharacterRenderFunc(c))),s[0].push(new Shape(t[0]+217,t[1]+128,t[2]+500,"profile/frame_spouse.png",102,106,r)),s[0].push(new Shape(t[0]+215,t[1]+219,t[2]+501,"profile/scroll_spouse.png",106,30,r)),c.alive||s[0].push(new Shape(t[0]+297,t[1]+218,t[2]+502,"portrait/skull_large.png",32,32,r));var d=c.age<16||e.age<16?"Betrothed":c.gender==gender.FEMALE?"Wife":"Husband";s[0].push(new TextLabel(t[0]+268,t[1]+239,503,170,16,d,"center","black",!0,r))}var m=renderCharacterPortrait(e,[50,60,10],r,!1,!0);s[0]=s[0].concat(m),e.alive||s[0].push(new Shape(t[0]+188,t[1]+207,t[2]+750,"portrait/skull_large.png",32,32,r));var g="Lowborn";if(e.house>0&&houses.has(e.house)){var u=houses.get(e.house);g=u.name,s[0].push(new Shape(t[0]+347,t[1]+78,t[2]+4,getHouseImage(u),80,84,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+347,t[1]+78,t[0]+347+80,t[1]+78+84,"House "+g))}s[0].push(new TextLabel(t[0]+384,t[1]+63,t[2]+5,150,16,g,"center","black",!0,r));var f=e.getRaceImage();s[0].push(new Shape(t[0]+349,t[1]+182,t[2]+10,f,33,33,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+349,t[1]+182,t[0]+382,t[1]+215,e.dndattributes.race));var _=e.getAlignmentImage();s[0].push(new Shape(t[0]+394,t[1]+182,t[2]+11,_,33,33,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+394,t[1]+182,t[0]+427,t[1]+215,e.getAlignmentText()));var w=e.getCK2Stats();s[0].push(new TextLabel(t[0]+488,t[1]+238,t[2]+12,100,17,w[0],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+488,t[1]+259,t[2]+12,100,17,w[1],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+488,t[1]+280,t[2]+12,100,17,w[2],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+488,t[1]+301,t[2]+12,100,17,w[3],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+488,t[1]+322,t[2]+12,100,17,w[4],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+488,t[1]+343,t[2]+12,100,17,w[5],"right","white",!1,r));var y=e.getStateAttributes();if(s[0].push(new TextLabel(t[0]+525,t[1]+236,t[2]+13,100,17,"(     )","right","white",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+257,t[2]+13,100,17,"(     )","right","white",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+278,t[2]+13,100,17,"(     )","right","white",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+299,t[2]+13,100,17,"(     )","right","white",!1,r)),s[0].push(new TextLabel(t[0]+525,t[1]+320,t[2]+13,100,17,"(     )","right","white",!1,r)),s[0].push(new TextLabel(t[0]+520,t[1]+238,t[2]+14,100,17,y[0],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+520,t[1]+259,t[2]+14,100,17,y[1],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+520,t[1]+280,t[2]+14,100,17,y[2],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+520,t[1]+301,t[2]+14,100,17,y[3],"right","white",!1,r)),s[0].push(new TextLabel(t[0]+520,t[1]+322,t[2]+14,100,17,y[4],"right","white",!1,r)),e.dndattributes.npcClass>0&&npcClasses.has(e.dndattributes.npcClass)){var C=npcClasses.get(e.dndattributes.npcClass);s[0].push(new TextLabel(t[0]+387,t[1]+245,t[2]+13,90,18,C.name,"center","black",!0,r))}if(e.strongholdType!=strongholdType.NONE){var T=getStrongholdTypeIcon(e.strongholdType);s[0].push(new Shape(t[0]+381,t[1]+322,t[2]+14,T,24,24,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+381,t[1]+322,t[0]+405,t[1]+346,e.strongholdType))}if(e.strongholdClass!=classType.NONE){T=getStrongholdClassIcon(e.strongholdClass);s[0].push(new Shape(t[0]+410,t[1]+322,t[2]+14,T,24,24,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+410,t[1]+322,t[0]+434,t[1]+346,e.strongholdClass))}var b=(Me=24)+3,v=378,I=Math.floor(v/b);e.traits.length>I&&(b=Math.floor(v/e.traits.length));var M=Me;b<Me&&(M=b),e.traits.sort(function(e,t){return e-t});for(var k=0;k<e.traits.length;k++){var E=e.traits[k],A=o.get(E),L=A.getImageUrl(),S=45+b*k,R=t[0]+S,N=t[1]+295;s[0].push(new Shape(R,N,t[2]+12+k,L,24,24,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+M,N+24,A.getMouseOverText()))}var O=0;if(e.primaryTitle>0&&(O=e.primaryTitle),e.liege>0&&characterMap.has(e.liege)){for(var G=characterMap.get(e.liege),x=0==O,U=G;x;)U.primaryTitle>0?(O=U.primaryTitle,x=!1):0!=U.liege&&characterMap.has(U.liege)?(U=characterMap.get(U.liege),x=!0):x=!1;if(s.push(renderCharacterPortrait(G,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(231,48,550,74,74,i[l],r)),l++,s[0].push(new Shape(t[0]+224,t[1]+99,t[2]+600,"profile/scroll_heir.png",88,30,r)),s[0].push(new TextLabel(t[0]+268,t[1]+117,610,170,16,"Liege","center","black",!0,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+231,t[1]+48,t[0]+231+74,t[1]+48+74,getFullNameWithPrimaryTitleLocation(G))),profileClickableAreas.push(new ClickableShape(t[0]+231,t[1]+48,t[0]+231+74,t[1]+48+74,"Liege",makeCharacterRenderFunc(G))),G.hasPrimaryTitle()){var P=titles.get(G.primaryTitle),D=getTitleImages(P),H=getCrownImages(P);s[0].push(new Shape(t[0]+214,t[1]+70,t[2]+620,D[0],35,37,r)),s[0].push(new Shape(t[0]+214,t[1]+70,t[2]+622,D[1],35,37,r)),s[0].push(new Shape(t[0]+216,t[1]+46,t[2]+630,H[0],30,30,r)),s[0].push(new Shape(t[0]+216,t[1]+46,t[2]+632,H[1],30,30,r))}}if(O>0&&titles.has(O)){var F=titles.get(O);D=getTitleImages(F),H=getCrownImages(F);if(s[0].push(new Shape(t[0]+10,t[1]+140,t[2]+624,D[0],80,84,r)),s[0].push(new Shape(t[0]+10,t[1]+140,t[2]+626,D[1],80,84,r)),s[0].push(new Shape(t[0]+17,t[1]+88,t[2]+634,H[0],64,64,r)),s[0].push(new Shape(t[0]+17,t[1]+88,t[2]+636,H[1],64,64,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+10,t[1]+88,t[0]+10+80,t[1]+140+84,getTitleMouseOverText(F))),F.owner>0&&characterMap.has(F.owner)){var B=characterMap.get(F.owner);profileClickableAreas.push(new ClickableShape(t[0]+10,t[1]+88,t[0]+10+80,t[1]+140+84,"Title Owner",makeCharacterRenderFunc(B)))}}if(e.heir>0&&characterMap.has(e.heir)){var W=characterMap.get(e.heir);s.push(renderCharacterPortrait(W,[0,0,0],i[l],!1,!1)),s.push(new RenderedImage(69,210,700,70,70,i[l],r)),l++,profileMouseOverAreas.push(new MouseOverShape(t[0]+75,t[1]+215,t[0]+75+60,t[1]+215+60,getFullNameWithPrimaryTitleLocation(W))),profileClickableAreas.push(new ClickableShape(t[0]+75,t[1]+215,t[0]+75+60,t[1]+215+60,"Heir",makeCharacterRenderFunc(W))),s[0].push(new Shape(t[0]+76,t[1]+215,t[2]+800,"profile/frame_heir.png",59,49,r)),s[0].push(new Shape(t[0]+61,t[1]+259,t[2]+801,"profile/scroll_heir.png",88,30,r)),s[0].push(new TextLabel(t[0]+105,t[1]+277,810,170,16,"Heir","center","black",!0,r))}if(e.regent>0&&characterMap.has(e.regent)){var Y=characterMap.get(e.regent);s.push(renderCharacterPortrait(Y,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(153,210,750,70,70,i[l],r)),l++,profileMouseOverAreas.push(new MouseOverShape(t[0]+158,t[1]+215,t[0]+158+60,t[1]+215+60,getFullNameWithPrimaryTitleLocation(Y))),profileClickableAreas.push(new ClickableShape(t[0]+158,t[1]+215,t[0]+158+60,t[1]+215+60,"Regent",makeCharacterRenderFunc(Y))),s[0].push(new Shape(t[0]+145,t[1]+259,t[2]+803,"profile/scroll_heir.png",88,30,r)),s[0].push(new TextLabel(t[0]+189,t[1]+277,810,170,16,"Regent","center","black",!0,r))}if(e.titles.length>0){e.titles.sort(function(e,t){return titles.get(t).titleImportance-titles.get(e).titleImportance});b=(Me=26)+5,v=200,I=Math.floor(v/b);e.titles.length>I&&(b=Math.floor(v/e.titles.length));M=Me;b<Me&&(M=b);for(var K=0;K<e.titles.length;K++){var z=e.titles[K],X=titles.get(z);S=44+b*K,R=t[0]+S,N=t[1]+361,D=getTitleImages(X),H=getCrownImages(X);s[0].push(new Shape(R,N,t[2]+640+K,D[0],26,27,r)),s[0].push(new Shape(R,N,t[2]+643+K,D[1],26,27,r)),s[0].push(new Shape(R+1,N-20,t[2]+645+K,H[0],24,24,r)),s[0].push(new Shape(R+1,N-20,t[2]+647+K,H[1],24,24,r)),profileMouseOverAreas.push(new MouseOverShape(R,N-20,R+M,N+51,getTitleMouseOverText(X)))}}if(e.claims.length>0){e.claims.sort(function(e,t){return titles.get(t).titleImportance-titles.get(e).titleImportance});b=(Me=24)+4,v=103,I=Math.floor(v/b);e.claims.length>I&&(b=Math.floor(v/e.claims.length));M=Me;b<Me&&(M=b);for(K=0;K<e.claims.length;K++){z=e.claims[K],X=titles.get(z),S=284+b*K,R=t[0]+S,N=t[1]+364,D=getTitleImages(X),H=getCrownImages(X);if(s[0].push(new Shape(R+.5,N,t[2]+640+K,D[0],22,23,r)),s[0].push(new Shape(R+.5,N,t[2]+642+K,D[1],22,23,r)),s[0].push(new Shape(R,N,t[2]+644+K,"profile/claim.png",24,24,r)),s[0].push(new Shape(R+1,N-19,t[2]+646+K,H[0],22,22,r)),s[0].push(new Shape(R+1,N-19,t[2]+648+K,H[1],22,22,r)),profileMouseOverAreas.push(new MouseOverShape(R,N-20,R+M,N+51,getTitleMouseOverText(X))),X.owner>0&&X.owner!=e.id){B=characterMap.get(X.owner);profileClickableAreas.push(new ClickableShape(R,N-20,R+M,N+51,"Title Owner",makeCharacterRenderFunc(B)))}}}if(e.council.exists()&&(s[0].push(new Shape(t[0]+344,t[1]+262,t[2]+610,"profile/has_council.png",87,24,r)),profileMouseOverAreas.push(new MouseOverShape(t[0]+344,t[1]+262,t[0]+344+87,t[1]+262+24,"View council")),profileClickableAreas.push(new ClickableShape(t[0]+344,t[1]+262,t[0]+344+87,t[1]+262+24,"Council Button",function(){drawCouncil(e.council,!1,!0,t,a,r,i)}))),e.pacts.length>0){e.pacts.sort(function(e,t){return pacts.get(e).getTypeIndex()-pacts.get(t).getTypeIndex()});b=(Me=24)+2,v=108,I=Math.floor(v/b);e.pacts.length>I&&(b=Math.floor(v/e.pacts.length));M=Me;b<Me&&(M=b);for(var j=0,J=0;J<e.pacts.length;J++){var Z=e.pacts[J],V=pacts.get(Z),$=V.getOtherCharacter(e.id);if(0!=$){var q=characterMap.get($);if(q.hasPrimaryTitle()){var Q=titles.get(q.primaryTitle);if(""!=Q.name){S=420+b*j,R=t[0]+S,N=t[1]+351,D=getTitleImages(Q);s[0].push(new Shape(R+1,N+17,t[2]+648+j,V.getImageUrl(),20,24,r)),s[0].push(new Shape(R,N,t[2]+650+j,D[0],22,23,r)),s[0].push(new Shape(R,N,t[2]+652+j,D[1],22,23,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+M,N+17+24,V.getDescription())),profileClickableAreas.push(new ClickableShape(R,N,R+M,N+17+24,"Pact Partner",makeCharacterRenderFunc(q))),j++}}}}}if(e.parents.length>0){var ee=e.getFather(),te=e.getMother(),ae=0,re=[[50,426],[114,426]],ie=[[[220,426],[290,426]],[[360,426],[430,426]]],ne=0,se=0;if(ee>0&&characterMap.has(ee)){R=t[0]+re[ae][0],N=t[1]+re[ae][1];var le=characterMap.get(ee);s.push(renderCharacterPortrait(le,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,t[2]+1100,70,70,i[l],r)),l++,profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(le))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Father",makeCharacterRenderFunc(le))),le.alive||s.push(new Shape(t[0]+re[ae][0]+9,t[1]+re[ae][1]+40,t[2]+1300,"portrait/skull.png",28,28,r));var oe=le.getFather(),he=le.getMother();if(oe>0&&characterMap.has(oe)){R=t[0]+ie[ne][se][0],N=t[1]+ie[ne][se][1];var pe=characterMap.get(oe);s.push(renderCharacterPortrait(pe,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,t[2]+1200,70,70,i[l],r)),l++,pe.alive||s.push(new Shape(R+9,N+40,t[2]+1310,"portrait/skull.png",28,28,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(pe))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Grandfather",makeCharacterRenderFunc(pe))),se=1}if(he>0&&characterMap.has(he)){R=t[0]+ie[ne][se][0],N=t[1]+ie[ne][se][1];var ce=characterMap.get(he);s.push(renderCharacterPortrait(ce,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,t[2]+1250,70,70,i[l],r)),l++,ce.alive||s.push(new Shape(R+9,N+40,t[2]+1320,"portrait/skull.png",28,28,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(ce))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Grandmother",makeCharacterRenderFunc(ce))),se=1}se>0&&(ne=1,se=0),ae++}if(te>0&&characterMap.has(te)){R=t[0]+re[ae][0],N=t[1]+re[ae][1];var de=characterMap.get(te);s.push(renderCharacterPortrait(de,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,1200,70,70,i[l],r)),l++,de.alive||s.push(new Shape(R+9,N+40,t[2]+1300,"portrait/skull.png",28,28,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(de))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Mother",makeCharacterRenderFunc(de)));oe=de.getFather(),he=de.getMother();if(oe>0&&characterMap.has(oe)){R=t[0]+ie[ne][se][0],N=t[1]+ie[ne][se][1],pe=characterMap.get(oe);s.push(renderCharacterPortrait(pe,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,t[2]+1400,70,70,i[l],r)),l++,pe.alive||s.push(new Shape(R+9,N+40,t[2]+1510,"portrait/skull.png",28,28,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(pe))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Grandfather",makeCharacterRenderFunc(pe))),se=1}if(he>0&&characterMap.has(he)){R=t[0]+ie[ne][se][0],N=t[1]+ie[ne][se][1],ce=characterMap.get(he);s.push(renderCharacterPortrait(ce,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,t[2]+1450,70,70,i[l],r)),l++,ce.alive||s.push(new Shape(R+9,N+40,t[2]+1520,"portrait/skull.png",28,28,r)),profileMouseOverAreas.push(new MouseOverShape(R,N,R+70,N+70,getFullNameWithPrimaryTitleLocation(ce))),profileClickableAreas.push(new ClickableShape(R,N,R+70,N+70,"Grandmother",makeCharacterRenderFunc(ce))),se=1}}}if(e.children.length>0){e.children.sort(function(e,t){return characterMap.get(t).age-characterMap.get(e).age});b=(Me=55)+2,v=240,I=Math.floor(v/b);e.children.length>I&&(b=Math.floor(v/e.children.length));M=Me;b<Me&&(M=b);for(var me=0,ge=0;ge<e.children.length;ge++){var ue=e.children[ge];if(characterMap.has(ue)){var fe=characterMap.get(ue),_e=(S=30+b*me,R=t[0]+S,N=t[1]+518,t[2]+1600+100*me);s.push(renderCharacterPortrait(fe,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,_e,70,70,i[l],r)),l++,fe.alive||s.push(new Shape(R+9,N+40,_e+50,"portrait/skull.png",28,28,r));var we=(Se=R+5)+M,ye=(Re=N+5)+60;me==e.children.length-1&&(we=Se+60),profileMouseOverAreas.push(new MouseOverShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(fe))),profileClickableAreas.push(new ClickableShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(fe),makeCharacterRenderFunc(fe))),me++}}}var Ce=e.getSiblings();if(Ce.length>0){Ce.sort(function(e,t){return characterMap.get(t).age-characterMap.get(e).age});b=(Me=55)+2,v=130,I=Math.floor(v/b);Ce.length>I&&(b=Math.floor(v/Ce.length));M=Me;b<Me&&(M=b);for(var Te=0,be=0;be<Ce.length;be++){var ve=Ce[be];if(characterMap.has(ve)){var Ie=characterMap.get(ve);S=334+b*Te,R=t[0]+S,N=t[1]+518,_e=t[2]+2600+100*Te;s.push(renderCharacterPortrait(Ie,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,_e,70,70,i[l],r)),l++,Ie.alive||s.push(new Shape(R+9,N+40,_e+50,"portrait/skull.png",28,28,r));we=(Se=R+5)+M,ye=(Re=N+5)+60;Te==Ce.length-1&&(we=Se+60),profileMouseOverAreas.push(new MouseOverShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(Ie))),profileClickableAreas.push(new ClickableShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(Ie),makeCharacterRenderFunc(Ie))),Te++}}}if(e.vassals.length>0){e.vassals.sort(function(e,t){return characterMap.get(t).getImportance()-characterMap.get(e).getImportance()});var Me;b=(Me=55)+5,v=450,I=Math.floor(v/b);e.vassals.length>I&&(b=Math.floor(v/e.vassals.length));M=Me;b<Me&&(M=b);for(var ke=0,Ee=0;Ee<e.vassals.length;Ee++){var Ae=e.vassals[Ee];if(characterMap.has(Ae)){var Le=characterMap.get(Ae);S=30+b*ke,R=t[0]+S,N=t[1]+610,_e=t[2]+3600+100*ke;s.push(renderCharacterPortrait(Le,[0,0,0],i[l],!1,!0)),s.push(new RenderedImage(R,N,_e,70,70,i[l],r)),l++,Le.alive||s.push(new Shape(R+9,N+40,_e+50,"portrait/skull.png",28,28,r));var Se,Re;we=(Se=R+5)+M,ye=(Re=N+5)+60;ke==e.vassals.length-1&&(we=Se+60),profileMouseOverAreas.push(new MouseOverShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(Le))),profileClickableAreas.push(new ClickableShape(Se,Re,we,ye,getFullNameWithPrimaryTitleLocation(Le),makeCharacterRenderFunc(Le))),ke++}}}for(n=0;n<s.length;n++)a.addElements(s[n]);profileMouseOverAreas.sort(function(e,t){return t.minX-e.minX}),profileClickableAreas.sort(function(e,t){return t.minX-e.minX})}function makeCharacterRenderFunc(e){return function(){renderOwner(e.id)}}function initSampleCharacterWithGender(e,t){var a=initSampleCharacter(e),r=t==gender.FEMALE;return a.gender!=t&&(a.gender=t,a.name=r?femaleNames[getRandomNumber(0,femaleNames.length)]:maleNames[getRandomNumber(0,maleNames.length)]),a}function randomizeAge(e){e.age=getRandomNumber(6,90)}function randomizeStronghold(e){var t=[strongholdType.ESTABLISHMENT,strongholdType.KEEP,strongholdType.TOWER,strongholdType.TEMPLE],a=[classType.BARBARIAN,classType.BARD,classType.CLERIC,classType.DRUID,classType.FIGHTER,classType.MONK,classType.PALADIN,classType.RANGER,classType.ROGUE,classType.SORCERER,classType.WARLOCK,classType.WIZARD];e.strongholdType=t[getRandomNumber(0,4)],e.strongholdClass=a[getRandomNumber(0,13)]}function getRandomName(e){return e?femaleNames[getRandomNumber(0,femaleNames.length)]:maleNames[getRandomNumber(0,maleNames.length)]}function initSampleCharacter(e,t=!1,a=!1){console.log("Initializing Sample Character");var r=coinFlip(),i=new Character(getRandomName(r),characterIterator++);if(i.gender=r?gender.FEMALE:gender.MALE,randomizeAge(i),i.dndattributes.strength=getRandomStat(),i.dndattributes.dexterity=getRandomStat(),i.dndattributes.constitution=getRandomStat(),i.dndattributes.intelligence=getRandomStat(),i.dndattributes.wisdom=getRandomStat(),i.dndattributes.charisma=getRandomStat(),a&&randomizeStronghold(i),t)if(getRandomNumber(0,2)>0){console.log("Grabbing random house... ");var n=Array.from(houses.keys())[getRandomNumber(0,houses.size)];i.house=n,console.log("Getting house "+n+": "+houses.get(n).name)}else console.log("Lowborn");(randomizeAlignment(i),randomizePortraitData(i),randomizeNpcClass(i),characterMap.set(i.id,i),e)&&newRandomTitle(getRandomNumber(0,6),i,!0);return randomizeCharacterTraits(i),i}function randomizeNpcClass(e){if(npcClasses){console.log("Grabbing random npcClass... ");var t=Array.from(npcClasses.keys())[getRandomNumber(0,npcClasses.size)];e.dndattributes.npcClass=t,console.log("Getting npcClass "+t+": "+npcClasses.get(t).name)}}function randomizeAlignment(e){var t=getRandomNumber(0,9);0==t&&(e.dndattributes.alignment=alignments.LG),1==t&&(e.dndattributes.alignment=alignments.NG),2==t&&(e.dndattributes.alignment=alignments.CG),3==t&&(e.dndattributes.alignment=alignments.LN),4==t&&(e.dndattributes.alignment=alignments.N),5==t&&(e.dndattributes.alignment=alignments.CN),6==t&&(e.dndattributes.alignment=alignments.LE),7==t&&(e.dndattributes.alignment=alignments.NE),8==t&&(e.dndattributes.alignment=alignments.CE)}var sampleTitles=[],sampleTitleClaims=[];function initSampleTitles(){if(0==sampleTitles.length){sampleTitles.push("Attenweiler"),sampleTitles.push("Bad Ilex"),sampleTitles.push("Donnerfeste"),sampleTitles.push("Dronenmarsch"),sampleTitles.push("Ehrenstein"),sampleTitles.push("Fronsmal"),sampleTitles.push("Frostforst"),sampleTitles.push("Gilead"),sampleTitles.push("Grubenschatten"),sampleTitles.push("Gwindalia"),sampleTitles.push("Hopfenpfahl"),sampleTitles.push("Ilex"),sampleTitles.push("Kielingen"),sampleTitles.push("Mistwatch"),sampleTitles.push("Norvall"),sampleTitles.push("Obergau"),sampleTitles.push("Oztroja"),sampleTitles.push("Phandelver"),sampleTitles.push("Rottenstrand"),sampleTitles.push("Sankt Gulian"),sampleTitles.push("Vogelfrei"),sampleTitles.push("Weizenstrand"),sampleTitles.push("Zankbräu"),sampleTitleClaims.push("Attenweiler"),sampleTitleClaims.push("Bad Ilex"),sampleTitleClaims.push("Donnerfeste"),sampleTitleClaims.push("Dronenmarsch"),sampleTitleClaims.push("Ehrenstein"),sampleTitleClaims.push("Fronsmal"),sampleTitleClaims.push("Frostforst"),sampleTitleClaims.push("Gilead"),sampleTitleClaims.push("Grubenschatten"),sampleTitleClaims.push("Gwindalia"),sampleTitleClaims.push("Hopfenpfahl"),sampleTitleClaims.push("Ilex"),sampleTitleClaims.push("Kielingen"),sampleTitleClaims.push("Mistwatch"),sampleTitleClaims.push("Norvall"),sampleTitleClaims.push("Obergau"),sampleTitleClaims.push("Oztroja"),sampleTitleClaims.push("Phandelver"),sampleTitleClaims.push("Rottenstrand"),sampleTitleClaims.push("Sankt Gulian"),sampleTitleClaims.push("Vogelfrei"),sampleTitleClaims.push("Weizenstrand"),sampleTitleClaims.push("Zankbräu");for(var e=1;e<162;e++)sampleTitles.push(e.toString()),sampleTitleClaims.push(e.toString())}}function initSampleHouses(){if(0==houses.size){var e=new House("Agilolf",houseIterator++);houses.set(e.id,e);var t=new House("Amorias",houseIterator++);houses.set(t.id,t);var a=new House("Corrino",houseIterator++);houses.set(a.id,a);var r=new House("De Conteville",houseIterator++);houses.set(r.id,r);var i=new House("Draculesti",houseIterator++);houses.set(i.id,i);var n=new House("Dunois",houseIterator++);houses.set(n.id,n);var s=new House("Flitzing",houseIterator++);houses.set(s.id,s);var l=new House("Hawking",houseIterator++);houses.set(l.id,l);var o=new House("Izyaslavich",houseIterator++);houses.set(o.id,o);var h=new House("Leon",houseIterator++);houses.set(h.id,h);var p=new House("Pensec",houseIterator++);houses.set(p.id,p);var c=new House("Ravensgar",houseIterator++);houses.set(c.id,c);var d=new House("Rothirsch",houseIterator++);houses.set(d.id,d);var m=new House("Troja",houseIterator++);houses.set(m.id,m);var g=new House("Vanderfel",houseIterator++);houses.set(g.id,g);var u=new House("Zelking",houseIterator++);houses.set(u.id,u)}}function newRandomTitle(e,t,a){if(e>0){var r="";if(sampleTitles.length>0){r=sampleTitles[getRandomNumber(0,sampleTitles.length)];var i=sampleTitles.indexOf(r);-1!==i&&sampleTitles.splice(i,1)}var n=titleIterator++,s=1==e?new Holding(r,n):2==e?new County(r,n):3==e?new Duchy(r,n):4==e?new Kingdom(r,n):new Empire(r,n);null!=t&&t.addTitle(s.id,a),titles.set(s.id,s)}else null!=t&&(t.primaryTitle=0)}function getRandomStat(){return[getRandomNumber(1,7),getRandomNumber(1,7),getRandomNumber(1,7),getRandomNumber(1,7)].sort(function(e,t){return e-t}).slice(-3).reduce((e,t)=>e+t,0)}function randomizePortraitData(e){var t=portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN);e.portraitData=t.RandomPortrait(e)}function getBackground(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getBackgroundUrl(e),i=e.portraitData.backgroundIndex,n=new Shape(t[0]+24,t[1]+24,t[2]+10,r,152,152,a);return n.partial=!0,n.partialX=152*i,n.partialY=0,n.partialHeight=152,n.partialWidth=152,n}function getAgeIndex(e){return e.age>=70?3:e.age>=50?2:1}function getFace(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getFaceUrl(e);return new Shape(t[0]+24,t[1]+24,t[2]+40,r,152,152,a)}function getHair(e,t,a,r){var i=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getHairUrl(e,r),n=r?20:50,s=new Shape(t[0]+24,t[1]+24,t[2]+n,i,152,152,a);return s.partial=!0,s.partialX=152*e.portraitData.hairIndex,s.partialY=0,s.partialHeight=152,s.partialWidth=152,s}function getBeard(e,t,a,r){var i=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getBeardUrl(e,r);if(""==i)return null;var n=r?38:62,s=new Shape(t[0]+24,t[1]+24,t[2]+n,i,152,152,a);return s.partial=!0,s.partialX=152*e.portraitData.beard,s.partialY=0,s.partialHeight=152,s.partialWidth=152,s}function getCheeks(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getCheekUrl(e),i=new Shape(t[0]+24,t[1]+24,t[2]+42,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.cheeks,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getChin(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getChinUrl(e),i=new Shape(t[0]+24,t[1]+24,t[2]+44,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.chin,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getNeck(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getNeckUrl(e);if(""==r)return null;var i=new Shape(t[0]+24,t[1]+24,t[2]+41,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.neck,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getEar(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getEarUrl(e),i=new Shape(t[0]+24,t[1]+24,t[2]+46,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.ear,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getEyes(e,t,a){var r=[],i=portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN),n=i.getEyeUrl(e),s=new Shape(t[0]+24,t[1]+24,t[2]+48,n,152,152,a);s.partial=!0,s.partialX=152*e.portraitData.eyes,s.partialY=0,s.partialHeight=152,s.partialWidth=152,r.push(s);var l=i.getEyeColorUrl(e);if(""!=l){var o=new Shape(t[0]+24,t[1]+24,t[2]+49,l,152,152,a);o.partial=!0,o.partialX=152*e.portraitData.eyes,o.partialY=0,o.partialHeight=152,o.partialWidth=152,r.push(o)}return r}function getMouth(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getMouthUrl(e),i=new Shape(t[0]+24,t[1]+24,t[2]+48,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.mouth,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getNose(e,t,a){var r=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getNoseUrl(e),i=new Shape(t[0]+24,t[1]+24,t[2]+49,r,152,152,a);return i.partial=!0,i.partialX=152*e.portraitData.nose,i.partialY=0,i.partialHeight=152,i.partialWidth=152,i}function getClothes(e,t,a,r){var i=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getClothesUrl(e,r),n=e.portraitData.clothes;e.getRulerType()>=3&&(i="portrait/religious_"+(e.gender==gender.FEMALE?"female_":"male_")+(r?"clothes_behind.png":"clothes.png"),n=4==e.getRulerType()?0:1);var s=new Shape(t[0]+24,t[1]+24,t[2]+(r?30:60),i,152,152,a);return s.partial=!0,s.partialX=152*n,s.partialY=0,s.partialHeight=152,s.partialWidth=152,s}function getCrown(e,t,a,r){var i=5-titles.get(e.primaryTitle).titleImportance,n=(portraitRaces.has(e.dndattributes.race)?portraitRaces.get(e.dndattributes.race):portraitRaces.get(race.HUMAN)).getCrownUrl(e,r);e.getRulerType()>=3&&(n="portrait/religious_"+(e.gender==gender.FEMALE?"female_":"male_")+(r?"headgear_behind.png":"headgear.png"),i=4==e.getRulerType()?0:1);var s=new Shape(t[0]+24,t[1]+24,t[2]+(r?25:65),n,152,152,a);return s.partial=!0,s.partialX=152*i,s.partialY=0,s.partialHeight=152,s.partialWidth=152,s}function renderCharacterPortrait(e,t,a,r,i){var n=[],s=e.hasPrimaryTitle();e.gender==gender.MALE&&e.age;if(r&&n.push(new Shape(-1,2,t[2]+1,"portrait/society_symbol_bg_stone.png",200,201,a)),e.age<16)e.gender==gender.OTHER?n.push(new Shape(t[0]+24,t[1]+24,t[2]+2,"portrait/duck_son.png",152,152,a)):e.gender==gender.MALE?n.push(new Shape(t[0]+24,t[1]+24,t[2]+2,"portrait/default_son.png",152,152,a)):e.gender==gender.FEMALE&&n.push(new Shape(t[0]+24,t[1]+24,t[2]+2,"portrait/default_daughter.png",152,152,a));else{n.push(getBackground(e,t,a)),n.push(getHair(e,t,a,!0)),s&&n.push(getCrown(e,t,a,!0)),n.push(getClothes(e,t,a,!0));var l=getBeard(e,t,a,!0);null!=l&&n.push(l),n.push(getFace(e,t,a));var o=getNeck(e,t,a);null!=o&&n.push(o),n.push(getCheeks(e,t,a)),n.push(getChin(e,t,a)),n.push(getMouth(e,t,a)),n.push(getNose(e,t,a)),n.push(getEar(e,t,a));for(var h=getEyes(e,t,a),p=0;p<h.length;p++)n.push(h[p]);n.push(getHair(e,t,a,!1)),n.push(getClothes(e,t,a,!1));var c=getBeard(e,t,a,!1);null!=c&&n.push(c),s&&n.push(getCrown(e,t,a,!1))}if(i)if(s){var d=new Map;d.set(1,["portrait/Baron_Feudal.png","portrait/Baron_Republic.png","portrait/Baron_Theological.png","portrait/King_Theological.png"]),d.set(2,["portrait/Count_Feudal.png","portrait/Count_Republic.png","portrait/Count_Theological.png","portrait/King_Theological.png"]),d.set(3,["portrait/Duke_Feudal.png","portrait/Duke_Republic.png","portrait/Duke_Theological.png","portrait/King_Theological.png"]),d.set(4,["portrait/King_Feudal.png","portrait/King_Republic.png","portrait/King_Theological.png","portrait/King_Theological.png"]),d.set(5,["portrait/Emperor_Feudal.png","portrait/Emperor_Republic.png","portrait/Emperor_Theological.png","portrait/King_Theological.png"]);var m=titles.get(e.primaryTitle);if(d.has(m.titleImportance)){var g=d.get(m.titleImportance),u=e.getRulerType(),f=g[Math.max(0,u-1)];n.push(new Shape(t[0]+12,t[1]+12,t[2]+300,f,176,176,a))}}else n.push(new Shape(t[0]+12,t[1]+12,t[2]+300,"portrait/Lowborn_Feudal.png",176,176,a));return n}function RacePortraitMetaData(e){this.name=e,this.male=new RacePortraitData(e,gender.MALE),this.female=new RacePortraitData(e,gender.FEMALE)}function RacePortraitData(e,t){this.name=e,this.gender=t,this.childAge=0,this.childDefaultUrl="",this.ages=[],this.backgrounds=0,this.hairs=0,this.hairColors=0,this.clothes=0,this.cheeks=0,this.chins=0,this.eyes=0,this.eyeColors=0,this.mouths=0,this.noses=0,this.necks=0,this.ears=0,this.beards=0,this.backgroundUrl="",this.clothesUrl="",this.clothesBehindUrl="",this.headgearUrl="",this.headgearBehindUrl="",this.faceUrls=[],this.cheekUrls=[],this.chinUrls=[],this.neckUrls=[],this.earUrls=[],this.noseUrls=[],this.mouthUrls=[],this.hairUrls=[],this.hairBehindUrls=[],this.eyeUrls=[],this.eyeColorUrls=[],this.beardUrls=[],this.beardBehindUrls=[]}RacePortraitMetaData.prototype.RandomPortrait=function(e){return e.gender==gender.MALE?this.male.RandomPortrait():this.female.RandomPortrait()},RacePortraitMetaData.prototype.getGenderedElement=function(e){return e.gender==gender.MALE?this.male:this.female},RacePortraitMetaData.prototype.getBackgroundUrl=function(e){return this.getGenderedElement(e).getBackgroundUrl(e)},RacePortraitMetaData.prototype.getFaceUrl=function(e){return this.getGenderedElement(e).getFaceUrl(e)},RacePortraitMetaData.prototype.getCheekUrl=function(e){return this.getGenderedElement(e).getCheekUrl(e)},RacePortraitMetaData.prototype.getChinUrl=function(e){return this.getGenderedElement(e).getChinUrl(e)},RacePortraitMetaData.prototype.getNeckUrl=function(e){return this.getGenderedElement(e).getNeckUrl(e)},RacePortraitMetaData.prototype.getEarUrl=function(e){return this.getGenderedElement(e).getEarUrl(e)},RacePortraitMetaData.prototype.getNoseUrl=function(e){return this.getGenderedElement(e).getNoseUrl(e)},RacePortraitMetaData.prototype.getMouthUrl=function(e){return this.getGenderedElement(e).getMouthUrl(e)},RacePortraitMetaData.prototype.getEyeUrl=function(e){return this.getGenderedElement(e).getEyeUrl(e)},RacePortraitMetaData.prototype.getEyeColorUrl=function(e){return this.getGenderedElement(e).getEyeColorUrl(e)},RacePortraitMetaData.prototype.getHairUrl=function(e,t){return this.getGenderedElement(e).getHairUrl(e,t)},RacePortraitMetaData.prototype.getBeardUrl=function(e,t){return this.getGenderedElement(e).getBeardUrl(e,t)},RacePortraitMetaData.prototype.getClothesUrl=function(e,t){return this.getGenderedElement(e).getClothesUrl(e,t)},RacePortraitMetaData.prototype.getCrownUrl=function(e,t){return this.getGenderedElement(e).getCrownUrl(e,t)},RacePortraitData.prototype.getAgeIndex=function(e){for(var t=0,a=0;a<this.ages.length&&!(this.ages[a]>=e.age);a++)t=a;return t},RacePortraitData.prototype.getBackgroundUrl=function(e){return this.backgroundUrl},RacePortraitData.prototype.getFaceUrl=function(e){var t=this.getAgeIndex(e);return this.faceUrls[t]},RacePortraitData.prototype.getCheekUrl=function(e){var t=this.getAgeIndex(e);return this.cheekUrls[t]},RacePortraitData.prototype.getChinUrl=function(e){var t=this.getAgeIndex(e);return this.chinUrls[t]},RacePortraitData.prototype.getNeckUrl=function(e){var t=this.getAgeIndex(e);return this.neckUrls[t]},RacePortraitData.prototype.getEarUrl=function(e){var t=this.getAgeIndex(e);return this.earUrls[t]},RacePortraitData.prototype.getNoseUrl=function(e){var t=this.getAgeIndex(e);return this.noseUrls[t]},RacePortraitData.prototype.getMouthUrl=function(e){var t=this.getAgeIndex(e);return this.mouthUrls[t]},RacePortraitData.prototype.getHairUrl=function(e,t){var a=this.getAgeIndex(e),r=e.portraitData.hairColor;return r>=this.hairColors&&(r=0),t?this.hairBehindUrls[a][r]:this.hairUrls[a][r]},RacePortraitData.prototype.getClothesUrl=function(e,t){return t?this.clothesBehindUrl:this.clothesUrl},RacePortraitData.prototype.getCrownUrl=function(e,t){return t?this.headgearBehindUrl:this.headgearUrl},RacePortraitData.prototype.getEyeUrl=function(e){var t=this.getAgeIndex(e);return this.eyeUrls[t]},RacePortraitData.prototype.getEyeColorUrl=function(e){var t=e.portraitData.eyeColor;return t<this.eyeColorUrls.length?this.eyeColorUrls[t]:""},RacePortraitData.prototype.getBeardUrl=function(e,t){var a=this.getAgeIndex(e);if(t&&0==this.beardBehindUrls.length)return"";if(!t&&0==this.beardUrls.length)return"";var r=e.portraitData.hairColor;return r>=this.hairColors&&(r=0),t?this.beardBehindUrls[a][r]:this.beardUrls[a][r]},RacePortraitData.prototype.RandomPortrait=function(e){var t=new PortraitData;return t.backgroundIndex=getRandomNumber(0,this.backgrounds),t.hairIndex=getRandomNumber(0,this.hairs),t.hairColor=getRandomNumber(0,this.hairColors),t.clothes=getRandomNumber(0,this.clothes),t.cheeks=getRandomNumber(0,this.cheeks),t.chin=getRandomNumber(0,this.chins),t.eyes=getRandomNumber(0,this.eyes),t.eyeColor=getRandomNumber(0,this.eyeColors),t.mouth=getRandomNumber(0,this.mouths),t.nose=getRandomNumber(0,this.noses),t.neck=getRandomNumber(0,this.necks),t.ear=getRandomNumber(0,this.ears),t.beard=getRandomNumber(0,this.beards),t};var portraitRaces=new Map,western=new RacePortraitMetaData(race.HUMAN);western.male.backgrounds=32,western.male.hairs=14,western.male.hairColors=3,western.male.clothes=12,western.male.cheeks=11,western.male.chins=13,western.male.eyes=13,western.male.eyeColors=3,western.male.mouths=13,western.male.noses=13,western.male.necks=4,western.male.ears=10,western.male.beards=8,western.male.childAge=16,western.male.childDefaultUrl="portrait/default_son.png",western.male.ages=[16,50,70],western.male.backgroundUrl="portrait/human_backgrounds.png",western.male.clothesUrl="portrait/western_male/western_male_clothes.png",western.male.clothesBehindUrl="portrait/western_male/western_male_clothes_behind.png",western.male.headgearUrl="portrait/western_male/western_male_headgear.png",western.male.headgearBehindUrl="portrait/western_male/western_male_headgear_behind.png",western.male.faceUrls=["portrait/western_male/western_male_base_1.png","portrait/western_male/western_male_base_2.png","portrait/western_male/western_male_base_3.png"],western.male.cheekUrls=["portrait/western_male/western_male_cheeks_1.png","portrait/western_male/western_male_cheeks_2.png","portrait/western_male/western_male_cheeks_3.png"],western.male.chinUrls=["portrait/western_male/western_male_chin_1.png","portrait/western_male/western_male_chin_2.png","portrait/western_male/western_male_chin_3.png"],western.male.neckUrls=["portrait/western_male/western_male_neck_1.png","portrait/western_male/western_male_neck_2.png","portrait/western_male/western_male_neck_3.png"],western.male.earUrls=["portrait/western_male/western_male_ear_fixed_1.png","portrait/western_male/western_male_ear_fixed_2.png","portrait/western_male/western_male_ear_fixed_3.png"],western.male.eyeUrls=["portrait/western_male/western_male_eyes_fixed_1.png","portrait/western_male/western_male_eyes_fixed_2.png","portrait/western_male/western_male_eyes_fixed_3.png"],western.male.eyeColorUrls=["","portrait/western_male/western_male_eyes_blue_fixed_1.png","portrait/western_male/western_male_eyes_brown_fixed_1.png"],western.male.noseUrls=["portrait/western_male/western_male_nose_fixed_1.png","portrait/western_male/western_male_nose_fixed_2.png","portrait/western_male/western_male_nose_fixed_3.png"],western.male.mouthUrls=["portrait/western_male/western_male_mouth_fixed_1.png","portrait/western_male/western_male_mouth_fixed_2.png","portrait/western_male/western_male_mouth_fixed_3.png"],western.male.hairUrls=[["portrait/western_male/western_male_hair_1.png","portrait/western_male/western_male_hair_brown_1.png","portrait/western_male/western_male_hair_blond_1.png"],["portrait/western_male/western_male_hair_2.png","portrait/western_male/western_male_hair_brown_2.png","portrait/western_male/western_male_hair_blond_2.png"],["portrait/western_male/western_male_hair_3.png","portrait/western_male/western_male_hair_3.png","portrait/western_male/western_male_hair_3.png"]],western.male.hairBehindUrls=[["portrait/western_male/western_male_hair_behind_1.png","portrait/western_male/western_male_hair_behind_brown_1.png","portrait/western_male/western_male_hair_behind_blond_1.png"],["portrait/western_male/western_male_hair_behind_2.png","portrait/western_male/western_male_hair_behind_brown_2.png","portrait/western_male/western_male_hair_behind_blond_2.png"],["portrait/western_male/western_male_hair_behind_3.png","portrait/western_male/western_male_hair_behind_3.png","portrait/western_male/western_male_hair_behind_3.png"]],western.male.beardUrls=[["portrait/western_male/western_male_beard_1.png","portrait/western_male/western_male_beard_brown_1.png","portrait/western_male/western_male_beard_blond_1.png"],["portrait/western_male/western_male_beard_2.png","portrait/western_male/western_male_beard_brown_2.png","portrait/western_male/western_male_beard_blond_2.png"],["portrait/western_male/western_male_beard_3.png","portrait/western_male/western_male_beard_3.png","portrait/western_male/western_male_beard_3.png"]],western.male.beardBehindUrls=[["portrait/western_male/western_male_beard_behind_1.png","portrait/western_male/western_male_beard_behind_brown_1.png","portrait/western_male/western_male_beard_behind_blond_1.png"],["portrait/western_male/western_male_beard_behind_2.png","portrait/western_male/western_male_beard_behind_brown_2.png","portrait/western_male/western_male_beard_behind_blond_2.png"],["portrait/western_male/western_male_beard_behind_3.png","portrait/western_male/western_male_beard_behind_3.png","portrait/western_male/western_male_beard_behind_3.png"]],western.female.backgrounds=32,western.female.hairs=13,western.female.hairColors=3,western.female.clothes=12,western.female.cheeks=11,western.female.chins=13,western.female.eyes=13,western.female.eyeColors=3,western.female.mouths=13,western.female.noses=13,western.female.necks=4,western.female.ears=13,western.female.beards=0,western.female.childAge=16,western.female.childDefaultUrl="portrait/default_daughter.png",western.female.ages=[16,50,70],western.female.backgroundUrl="portrait/human_backgrounds.png",western.female.clothesUrl="portrait/western_female/western_female_clothes.png",western.female.clothesBehindUrl="portrait/western_female/western_female_clothes_behind.png",western.female.headgearUrl="portrait/western_female/western_female_headgear.png",western.female.headgearBehindUrl="portrait/western_female/western_female_headgear_behind.png",western.female.faceUrls=["portrait/western_female/western_female_base_1.png","portrait/western_female/western_female_base_2.png","portrait/western_female/western_female_base_3.png"],western.female.cheekUrls=["portrait/western_female/western_female_cheeks_1.png","portrait/western_female/western_female_cheeks_2.png","portrait/western_female/western_female_cheeks_3.png"],western.female.chinUrls=["portrait/western_female/western_female_chin_1.png","portrait/western_female/western_female_chin_2.png","portrait/western_female/western_female_chin_3.png"],western.female.neckUrls=["portrait/western_female/western_female_neck_1.png","portrait/western_female/western_female_neck_2.png","portrait/western_female/western_female_neck_3.png"],western.female.earUrls=["portrait/western_female/western_female_ear_fixed_1.png","portrait/western_female/western_female_ear_fixed_2.png","portrait/western_female/western_female_ear_fixed_3.png"],western.female.eyeUrls=["portrait/western_female/western_female_eyes_fixed_1.png","portrait/western_female/western_female_eyes_fixed_2.png","portrait/western_female/western_female_eyes_fixed_3.png"],western.female.eyeColorUrls=["","portrait/western_female/western_female_eyes_blue_fixed_1.png","portrait/western_female/western_female_eyes_brown_fixed_1.png"],western.female.noseUrls=["portrait/western_female/western_female_nose_fixed_1.png","portrait/western_female/western_female_nose_fixed_2.png","portrait/western_female/western_female_nose_fixed_3.png"],western.female.mouthUrls=["portrait/western_female/western_female_mouth_fixed_1.png","portrait/western_female/western_female_mouth_fixed_2.png","portrait/western_female/western_female_mouth_fixed_3.png"],western.female.hairUrls=[["portrait/western_female/western_female_hair_1.png","portrait/western_female/western_female_hair_brown_1.png","portrait/western_female/western_female_hair_blond_1.png"],["portrait/western_female/western_female_hair_2.png","portrait/western_female/western_female_hair_brown_2.png","portrait/western_female/western_female_hair_blond_2.png"],["portrait/western_female/western_female_hair_3.png","portrait/western_female/western_female_hair_3.png","portrait/western_female/western_female_hair_3.png"]],western.female.hairBehindUrls=[["portrait/western_female/western_female_hair_behind_1.png","portrait/western_female/western_female_hair_behind_brown_1.png","portrait/western_female/western_female_hair_behind_blond_1.png"],["portrait/western_female/western_female_hair_behind_2.png","portrait/western_female/western_female_hair_behind_brown_2.png","portrait/western_female/western_female_hair_behind_blond_2.png"],["portrait/western_female/western_female_hair_behind_3.png","portrait/western_female/western_female_hair_behind_3.png","portrait/western_female/western_female_hair_behind_3.png"]],portraitRaces.set(race.HUMAN,western);var dwarf=new RacePortraitMetaData(race.DWARFHILL);dwarf.male.backgrounds=21,dwarf.male.hairs=14,dwarf.male.hairColors=1,dwarf.male.clothes=15,dwarf.male.cheeks=11,dwarf.male.chins=13,dwarf.male.eyes=13,dwarf.male.eyeColors=1,dwarf.male.mouths=13,dwarf.male.noses=13,dwarf.male.necks=4,dwarf.male.ears=6,dwarf.male.beards=17,dwarf.male.childAge=16,dwarf.male.childDefaultUrl="portrait/default_son.png",dwarf.male.ages=[16,50,280],dwarf.male.backgroundUrl="portrait/goblin_backgrounds.png",dwarf.male.clothesUrl="portrait/dwarf_male/dwarf_male_clothes.png",dwarf.male.clothesBehindUrl="portrait/dwarf_male/dwarf_male_clothes_behind.png",dwarf.male.headgearUrl="portrait/dwarf_male/dwarf_male_headgear.png",dwarf.male.headgearBehindUrl="portrait/dwarf_male/dwarf_male_headgear_behind.png",dwarf.male.faceUrls=["portrait/dwarf_male/dwarf_male_base_1.png","portrait/dwarf_male/dwarf_male_base_2.png","portrait/dwarf_male/dwarf_male_base_3.png"],dwarf.male.cheekUrls=["portrait/dwarf_male/dwarf_male_cheeks_1.png","portrait/dwarf_male/dwarf_male_cheeks_2.png","portrait/dwarf_male/dwarf_male_cheeks_3.png"],dwarf.male.chinUrls=["portrait/dwarf_male/dwarf_male_chin_1.png","portrait/dwarf_male/dwarf_male_chin_2.png","portrait/dwarf_male/dwarf_male_chin_3.png"],dwarf.male.neckUrls=["portrait/dwarf_male/dwarf_male_neck_1.png","portrait/dwarf_male/dwarf_male_neck_2.png","portrait/dwarf_male/dwarf_male_neck_3.png"],dwarf.male.earUrls=["portrait/dwarf_male/dwarf_male_ear_1.png","portrait/dwarf_male/dwarf_male_ear_2.png","portrait/dwarf_male/dwarf_male_ear_3.png"],dwarf.male.eyeUrls=["portrait/dwarf_male/dwarf_male_eyes_1.png","portrait/dwarf_male/dwarf_male_eyes_2.png","portrait/dwarf_male/dwarf_male_eyes_3.png"],dwarf.male.eyeColorUrls=[""],dwarf.male.noseUrls=["portrait/dwarf_male/dwarf_male_nose_1.png","portrait/dwarf_male/dwarf_male_nose_2.png","portrait/dwarf_male/dwarf_male_nose_3.png"],dwarf.male.mouthUrls=["portrait/dwarf_male/dwarf_male_mouth_1.png","portrait/dwarf_male/dwarf_male_mouth_2.png","portrait/dwarf_male/dwarf_male_mouth_3.png"],dwarf.male.hairUrls=[["portrait/dwarf_male/dwarf_male_hair_1.png"],["portrait/dwarf_male/dwarf_male_hair_2.png"],["portrait/dwarf_male/dwarf_male_hair_3.png"]],dwarf.male.hairBehindUrls=[["portrait/dwarf_male/dwarf_male_hair_behind_1.png"],["portrait/dwarf_male/dwarf_male_hair_behind_2.png"],["portrait/dwarf_male/dwarf_male_hair_behind_3.png"]],dwarf.male.beardUrls=[["portrait/dwarf_male/dwarf_male_beard_1.png"],["portrait/dwarf_male/dwarf_male_beard_2.png"],["portrait/dwarf_male/dwarf_male_beard_3.png"]],dwarf.male.beardBehindUrls=[["portrait/dwarf_male/dwarf_male_beard_behind_1.png"],["portrait/dwarf_male/dwarf_male_beard_behind_2.png"],["portrait/dwarf_male/dwarf_male_beard_behind_3.png"]],dwarf.female.backgrounds=21,dwarf.female.hairs=13,dwarf.female.hairColors=1,dwarf.female.clothes=15,dwarf.female.cheeks=11,dwarf.female.chins=13,dwarf.female.eyes=13,dwarf.female.eyeColors=1,dwarf.female.mouths=13,dwarf.female.noses=13,dwarf.female.necks=0,dwarf.female.ears=6,dwarf.female.beards=10,dwarf.female.childAge=16,dwarf.female.childDefaultUrl="portrait/default_daughter.png",dwarf.female.ages=[16,50,280],dwarf.female.backgroundUrl="portrait/goblin_backgrounds.png",dwarf.female.clothesUrl="portrait/dwarf_female/dwarf_female_clothes.png",dwarf.female.clothesBehindUrl="portrait/dwarf_female/dwarf_female_clothes_behind.png",dwarf.female.headgearUrl="portrait/dwarf_female/dwarf_female_headgear.png",dwarf.female.headgearBehindUrl="portrait/dwarf_female/dwarf_female_headgear_behind.png",dwarf.female.faceUrls=["portrait/dwarf_female/dwarf_female_base_1.png","portrait/dwarf_female/dwarf_female_base_2.png","portrait/dwarf_female/dwarf_female_base_3.png"],dwarf.female.cheekUrls=["portrait/dwarf_female/dwarf_female_cheeks_1.png","portrait/dwarf_female/dwarf_female_cheeks_2.png","portrait/dwarf_female/dwarf_female_cheeks_3.png"],dwarf.female.chinUrls=["portrait/dwarf_female/dwarf_female_chin_1.png","portrait/dwarf_female/dwarf_female_chin_2.png","portrait/dwarf_female/dwarf_female_chin_3.png"],dwarf.female.neckUrls=["","",""],dwarf.female.earUrls=["portrait/dwarf_female/dwarf_female_ear_1.png","portrait/dwarf_female/dwarf_female_ear_2.png","portrait/dwarf_female/dwarf_female_ear_3.png"],dwarf.female.eyeUrls=["portrait/dwarf_female/dwarf_female_eyes_1.png","portrait/dwarf_female/dwarf_female_eyes_2.png","portrait/dwarf_female/dwarf_female_eyes_3.png"],dwarf.female.eyeColorUrls=[""],dwarf.female.noseUrls=["portrait/dwarf_female/dwarf_female_nose_1.png","portrait/dwarf_female/dwarf_female_nose_2.png","portrait/dwarf_female/dwarf_female_nose_3.png"],dwarf.female.mouthUrls=["portrait/dwarf_female/dwarf_female_mouth_1.png","portrait/dwarf_female/dwarf_female_mouth_2.png","portrait/dwarf_female/dwarf_female_mouth_3.png"],dwarf.female.hairUrls=[["portrait/dwarf_female/dwarf_female_hair_1.png"],["portrait/dwarf_female/dwarf_female_hair_2.png"],["portrait/dwarf_female/dwarf_female_hair_3.png"]],dwarf.female.hairBehindUrls=[["portrait/dwarf_female/dwarf_female_hair_behind_1.png"],["portrait/dwarf_female/dwarf_female_hair_behind_2.png"],["portrait/dwarf_female/dwarf_female_hair_behind_3.png"]],portraitRaces.set(race.DWARFMOUNTAIN,dwarf),portraitRaces.set(race.DWARFHILL,dwarf);var halfelf=new RacePortraitMetaData(race.HALFELF);halfelf.male.backgrounds=32,halfelf.male.hairs=13,halfelf.male.hairColors=1,halfelf.male.clothes=12,halfelf.male.cheeks=13,halfelf.male.chins=13,halfelf.male.eyes=13,halfelf.male.eyeColors=1,halfelf.male.mouths=13,halfelf.male.noses=13,halfelf.male.necks=4,halfelf.male.ears=5,halfelf.male.beards=13,halfelf.male.childAge=16,halfelf.male.childDefaultUrl="portrait/reiklander_son.png",halfelf.male.ages=[16,50,150],halfelf.male.backgroundUrl="portrait/human_backgrounds.png",halfelf.male.clothesUrl="portrait/halfelf_male/reiklander_male_clothes.png",halfelf.male.clothesBehindUrl="portrait/halfelf_male/reiklander_male_clothes_behind.png",halfelf.male.headgearUrl="portrait/halfelf_male/reiklander_male_headgear.png",halfelf.male.headgearBehindUrl="portrait/halfelf_male/reiklander_male_headgear_behind.png",halfelf.male.faceUrls=["portrait/halfelf_male/reiklander_male_base_1.png","portrait/halfelf_male/reiklander_male_base_2.png","portrait/halfelf_male/reiklander_male_base_3.png"],halfelf.male.cheekUrls=["portrait/halfelf_male/reiklander_male_cheeks_1.png","portrait/halfelf_male/reiklander_male_cheeks_2.png","portrait/halfelf_male/reiklander_male_cheeks_3.png"],halfelf.male.chinUrls=["portrait/halfelf_male/reiklander_male_chin_1.png","portrait/halfelf_male/reiklander_male_chin_2.png","portrait/halfelf_male/reiklander_male_chin_3.png"],halfelf.male.neckUrls=["portrait/halfelf_male/reiklander_male_neck_1.png","portrait/halfelf_male/reiklander_male_neck_2.png","portrait/halfelf_male/reiklander_male_neck_3.png"],halfelf.male.earUrls=["portrait/halfelf_male/reiklander_male_ear_1.png","portrait/halfelf_male/reiklander_male_ear_2.png","portrait/halfelf_male/reiklander_male_ear_3.png"],halfelf.male.eyeUrls=["portrait/halfelf_male/reiklander_male_eyes_1.png","portrait/halfelf_male/reiklander_male_eyes_2.png","portrait/halfelf_male/reiklander_male_eyes_3.png"],halfelf.male.eyeColorUrls=[""],halfelf.male.noseUrls=["portrait/halfelf_male/reiklander_male_nose_1.png","portrait/halfelf_male/reiklander_male_nose_2.png","portrait/halfelf_male/reiklander_male_nose_3.png"],halfelf.male.mouthUrls=["portrait/halfelf_male/reiklander_male_mouth_1.png","portrait/halfelf_male/reiklander_male_mouth_2.png","portrait/halfelf_male/reiklander_male_mouth_3.png"],halfelf.male.hairUrls=[["portrait/halfelf_male/reiklander_male_hair_1.png"],["portrait/halfelf_male/reiklander_male_hair_2.png"],["portrait/halfelf_male/reiklander_male_hair_3.png"]],halfelf.male.hairBehindUrls=[["portrait/halfelf_male/reiklander_male_hair_behind_1.png"],["portrait/halfelf_male/reiklander_male_hair_behind_2.png"],["portrait/halfelf_male/reiklander_male_hair_behind_3.png"]],halfelf.male.beardUrls=[["portrait/halfelf_male/reiklander_male_beard_1.png"],["portrait/halfelf_male/reiklander_male_beard_2.png"],["portrait/halfelf_male/reiklander_male_beard_3.png"]],halfelf.male.beardBehindUrls=[["portrait/halfelf_male/reiklander_male_beard_behind_1.png"],["portrait/halfelf_male/reiklander_male_beard_behind_2.png"],["portrait/halfelf_male/reiklander_male_beard_behind_3.png"]],halfelf.female.backgrounds=21,halfelf.female.hairs=13,halfelf.female.hairColors=1,halfelf.female.clothes=12,halfelf.female.cheeks=13,halfelf.female.chins=13,halfelf.female.eyes=13,halfelf.female.eyeColors=1,halfelf.female.mouths=13,halfelf.female.noses=13,halfelf.female.necks=3,halfelf.female.ears=5,halfelf.female.beards=0,halfelf.female.childAge=16,halfelf.female.childDefaultUrl="portrait/reiklander_daughter.png",halfelf.female.ages=[16,50,150],halfelf.female.backgroundUrl="portrait/human_backgrounds.png",halfelf.female.clothesUrl="portrait/halfelf_female/reiklander_female_clothes.png",halfelf.female.clothesBehindUrl="portrait/halfelf_female/reiklander_female_clothes_behind.png",halfelf.female.headgearUrl="portrait/halfelf_female/reiklander_female_headgear.png",halfelf.female.headgearBehindUrl="portrait/halfelf_female/reiklander_female_headgear_behind.png",halfelf.female.faceUrls=["portrait/halfelf_female/reiklander_female_base_1.png","portrait/halfelf_female/reiklander_female_base_2.png","portrait/halfelf_female/reiklander_female_base_3.png"],halfelf.female.cheekUrls=["portrait/halfelf_female/reiklander_female_cheeks_1.png","portrait/halfelf_female/reiklander_female_cheeks_2.png","portrait/halfelf_female/reiklander_female_cheeks_3.png"],halfelf.female.chinUrls=["portrait/halfelf_female/reiklander_female_chin_1.png","portrait/halfelf_female/reiklander_female_chin_2.png","portrait/halfelf_female/reiklander_female_chin_3.png"],halfelf.female.neckUrls=["","",""],halfelf.female.earUrls=["portrait/halfelf_female/reiklander_female_ear_1.png","portrait/halfelf_female/reiklander_female_ear_2.png","portrait/halfelf_female/reiklander_female_ear_3.png"],halfelf.female.eyeUrls=["portrait/halfelf_female/reiklander_female_eyes_1.png","portrait/halfelf_female/reiklander_female_eyes_2.png","portrait/halfelf_female/reiklander_female_eyes_3.png"],halfelf.female.eyeColorUrls=[""],halfelf.female.noseUrls=["portrait/halfelf_female/reiklander_female_nose_1.png","portrait/halfelf_female/reiklander_female_nose_2.png","portrait/halfelf_female/reiklander_female_nose_3.png"],halfelf.female.mouthUrls=["portrait/halfelf_female/reiklander_female_mouth_1.png","portrait/halfelf_female/reiklander_female_mouth_2.png","portrait/halfelf_female/reiklander_female_mouth_3.png"],halfelf.female.hairUrls=[["portrait/halfelf_female/reiklander_female_hair_1.png"],["portrait/halfelf_female/reiklander_female_hair_2.png"],["portrait/halfelf_female/reiklander_female_hair_3.png"]],halfelf.female.hairBehindUrls=[["portrait/halfelf_female/reiklander_female_hair_behind_1.png"],["portrait/halfelf_female/reiklander_female_hair_behind_2.png"],["portrait/halfelf_female/reiklander_female_hair_behind_3.png"]],portraitRaces.set(race.HALFELF,halfelf);var halforc=new RacePortraitMetaData(race.HALFORC);function Character(e,t){this.name=e,this.id=t,this.house=0,this.vassals=[],this.council=new Council(this.id),this.titles=[],this.claims=[],this.primaryTitle=0,this.modifiers=[],this.traits=[],this.ck2attributes=new CK2Attributes,this.dndattributes=new DNDAttributes,this.alive=!0,this.gender=gender.OTHER,this.age=1,this.epithet="",this.origin=0,this.customTitle="",this.rulerType=0,this.pacts=[],this.strongholdType=strongholdType.NONE,this.strongholdClass=classType.NONE,this.spouse=0,this.heir=0,this.children=[],this.parents=[],this.liege=0,this.regent=0,this.portraitData=new PortraitData}function PortraitData(){this.backgroundIndex=0,this.skinLight=!0,this.hairIndex=0,this.hairColor=0,this.clothes=0,this.cheeks=0,this.chin=0,this.eyes=0,this.eyeColor=0,this.ear=0,this.neck=0,this.mouth=0,this.nose=0,this.beard=0}function coinFlip(){return getRandomNumber(0,2)>0}function getRandomNumber(e,t){return Math.floor(Math.random()*(+t-+e))+ +e}function getOriginName(e){if(e.origin>0&&titles.has(e.origin)){var t=titles.get(e.origin);return 2==t.titleImportance&&titles.has(t.primaryHolding)?"of "+titles.get(t.primaryHolding).name:"of "+t.name}return""}function getTitleName(e){if(""!=e.customTitle)return e.customTitle;if(0==e.primaryTitle)return"";var t=e.gender==gender.FEMALE;if(titles.has(e.primaryTitle)){var a=titles.get(e.primaryTitle);if(1==a.titleImportance)return a.holdingType==holdingtypes.CASTLE?t?"Baroness":"Baron":a.holdingType==holdingtypes.CITY?"Mayor":a.holdingType==holdingtypes.TEMPLE?"Bishop":"";if(2==a.titleImportance)return t?"Countess":"Count";if(3==a.titleImportance)return t?"Duchess":"Duke";if(4==a.titleImportance)return t?"Queen":"King";if(5==a.titleImportance)return t?"Empress":"Emperor"}return""}function getFullName(e){var t="",a=getTitleName(e);a&&(t=a+" "),t+=e.name,e.epithet&&(t=t+" '"+e.epithet+"'");var r=getOriginName(e);return r&&(t=t+" "+r),t}function getFullNameWithPrimaryTitleLocation(e){var t="",a=getTitleName(e);if(a&&(t=a+" "),t+=e.name,e.epithet&&(t=t+" '"+e.epithet+"'"),e.house>0&&houses.has(e.house)&&(t=t+" "+houses.get(e.house).name),0!=e.primaryTitle&&titles.has(e.primaryTitle)){var r=titles.get(e.primaryTitle);2==r.titleImportance&&(r=titles.get(r.primaryHolding)),t=t+" of "+r.name}return t}function getTitleChainUp(e){for(var t=e,a=[];t;){if(t.primaryTitle>0&&titles.has(t.primaryTitle)){var r=titles.get(t.primaryTitle);a.push([t.id,r.id])}t=t.liege>0&&characterMap.has(t.liege)?characterMap.get(t.liege):null}return a}function getStrongholdTypeIcon(e){return e==strongholdType.ESTABLISHMENT?"stronghold/establishment.png":e==strongholdType.KEEP?"stronghold/keep.png":e==strongholdType.TEMPLE?"stronghold/temple.png":e==strongholdType.TOWER?"stronghold/tower.png":""}function getStrongholdClassIcon(e){var t="stronghold/";return e==classType.BARBARIAN?t+"barbarian.png":e==classType.BARD?t+"bard.png":e==classType.CLERIC?t+"cleric.png":e==classType.DRUID?t+"druid.png":e==classType.FIGHTER?t+"fighter.png":e==classType.MONK?t+"monk.png":e==classType.PALADIN?t+"paladin.png":e==classType.RANGER?t+"ranger.png":e==classType.ROGUE?t+"rogue.png":e==classType.SORCERER?t+"sorcerer.png":e==classType.WARLOCK?t+"warlock.png":e==classType.WIZARD?t+"wizard.png":""}function CK2Attributes(){this.diplomacy=0,this.stewardship=0,this.intrigue=0,this.martial=0,this.learning=0,this.combat=0}function DNDAttributes(){this.strength=10,this.dexterity=10,this.constitution=10,this.intelligence=10,this.wisdom=10,this.charisma=10,this.armorClass=10,this.race=race.HUMAN,this.alignment=alignments.N,this.npcClass=0}halforc.male.backgrounds=32,halforc.male.hairs=13,halforc.male.hairColors=1,halforc.male.clothes=12,halforc.male.cheeks=13,halforc.male.chins=13,halforc.male.eyes=13,halforc.male.eyeColors=1,halforc.male.mouths=13,halforc.male.noses=13,halforc.male.necks=4,halforc.male.ears=5,halforc.male.beards=13,halforc.male.childAge=16,halforc.male.childDefaultUrl="portrait/strigany_son.png",halforc.male.ages=[16,50,150],halforc.male.backgroundUrl="portrait/human_backgrounds.png",halforc.male.clothesUrl="portrait/halforc_male/strigany_male_clothes.png",halforc.male.clothesBehindUrl="portrait/halforc_male/strigany_male_clothes_behind.png",halforc.male.headgearUrl="portrait/halforc_male/strigany_male_headgear.png",halforc.male.headgearBehindUrl="portrait/halforc_male/strigany_male_headgear_behind.png",halforc.male.faceUrls=["portrait/halforc_male/strigany_male_base_1.png","portrait/halforc_male/strigany_male_base_2.png","portrait/halforc_male/strigany_male_base_3.png"],halforc.male.cheekUrls=["portrait/halforc_male/strigany_male_cheeks_1.png","portrait/halforc_male/strigany_male_cheeks_2.png","portrait/halforc_male/strigany_male_cheeks_3.png"],halforc.male.chinUrls=["portrait/halforc_male/strigany_male_chin_1.png","portrait/halforc_male/strigany_male_chin_2.png","portrait/halforc_male/strigany_male_chin_3.png"],halforc.male.neckUrls=["portrait/halforc_male/strigany_male_neck_1.png","portrait/halforc_male/strigany_male_neck_2.png","portrait/halforc_male/strigany_male_neck_3.png"],halforc.male.earUrls=["portrait/halforc_male/strigany_male_ear_1.png","portrait/halforc_male/strigany_male_ear_2.png","portrait/halforc_male/strigany_male_ear_3.png"],halforc.male.eyeUrls=["portrait/halforc_male/strigany_male_eyes_1.png","portrait/halforc_male/strigany_male_eyes_2.png","portrait/halforc_male/strigany_male_eyes_3.png"],halforc.male.eyeColorUrls=[""],halforc.male.noseUrls=["portrait/halforc_male/strigany_male_nose_1.png","portrait/halforc_male/strigany_male_nose_2.png","portrait/halforc_male/strigany_male_nose_3.png"],halforc.male.mouthUrls=["portrait/halforc_male/strigany_male_mouth_1.png","portrait/halforc_male/strigany_male_mouth_2.png","portrait/halforc_male/strigany_male_mouth_3.png"],halforc.male.hairUrls=[["portrait/halforc_male/strigany_male_hair_1.png"],["portrait/halforc_male/strigany_male_hair_2.png"],["portrait/halforc_male/strigany_male_hair_3.png"]],halforc.male.hairBehindUrls=[["portrait/halforc_male/strigany_male_hair_behind_1.png"],["portrait/halforc_male/strigany_male_hair_behind_2.png"],["portrait/halforc_male/strigany_male_hair_behind_3.png"]],halforc.male.beardUrls=[["portrait/halforc_male/strigany_male_beard_1.png"],["portrait/halforc_male/strigany_male_beard_2.png"],["portrait/halforc_male/strigany_male_beard_3.png"]],halforc.male.beardBehindUrls=[[""],[""],[""]],halforc.female.backgrounds=21,halforc.female.hairs=13,halforc.female.hairColors=1,halforc.female.clothes=12,halforc.female.cheeks=13,halforc.female.chins=13,halforc.female.eyes=13,halforc.female.eyeColors=1,halforc.female.mouths=13,halforc.female.noses=13,halforc.female.necks=3,halforc.female.ears=5,halforc.female.beards=0,halforc.female.childAge=16,halforc.female.childDefaultUrl="portrait/strigany_daughter.png",halforc.female.ages=[16,50,150],halforc.female.backgroundUrl="portrait/human_backgrounds.png",halforc.female.clothesUrl="portrait/halforc_female/strigany_female_clothes.png",halforc.female.clothesBehindUrl="portrait/halforc_female/strigany_female_clothes_behind.png",halforc.female.headgearUrl="portrait/halforc_female/strigany_female_headgear.png",halforc.female.headgearBehindUrl="portrait/halforc_female/strigany_female_headgear_behind.png",halforc.female.faceUrls=["portrait/halforc_female/strigany_female_base_1.png","portrait/halforc_female/strigany_female_base_2.png","portrait/halforc_female/strigany_female_base_3.png"],halforc.female.cheekUrls=["portrait/halforc_female/strigany_female_cheeks_1.png","portrait/halforc_female/strigany_female_cheeks_2.png","portrait/halforc_female/strigany_female_cheeks_3.png"],halforc.female.chinUrls=["portrait/halforc_female/strigany_female_chin_1.png","portrait/halforc_female/strigany_female_chin_2.png","portrait/halforc_female/strigany_female_chin_3.png"],halforc.female.neckUrls=["","",""],halforc.female.earUrls=["portrait/halforc_female/strigany_female_ear_1.png","portrait/halforc_female/strigany_female_ear_2.png","portrait/halforc_female/strigany_female_ear_3.png"],halforc.female.eyeUrls=["portrait/halforc_female/strigany_female_eyes_1.png","portrait/halforc_female/strigany_female_eyes_2.png","portrait/halforc_female/strigany_female_eyes_3.png"],halforc.female.eyeColorUrls=[""],halforc.female.noseUrls=["portrait/halforc_female/strigany_female_nose_1.png","portrait/halforc_female/strigany_female_nose_2.png","portrait/halforc_female/strigany_female_nose_3.png"],halforc.female.mouthUrls=["portrait/halforc_female/strigany_female_mouth_1.png","portrait/halforc_female/strigany_female_mouth_2.png","portrait/halforc_female/strigany_female_mouth_3.png"],halforc.female.hairUrls=[["portrait/halforc_female/strigany_female_hair_1.png"],["portrait/halforc_female/strigany_female_hair_2.png"],["portrait/halforc_female/strigany_female_hair_3.png"]],halforc.female.hairBehindUrls=[["portrait/halforc_female/strigany_female_hair_behind_1.png"],["portrait/halforc_female/strigany_female_hair_behind_2.png"],["portrait/halforc_female/strigany_female_hair_behind_3.png"]],portraitRaces.set(race.HALFORC,halforc),Character.prototype.needsRegent=function(){return this.age<16||this.traits.includes(32)},Character.prototype.sanityCheck=function(){var e=!1;this.name=this.name.trim();var t=0!=this.primaryTitle&&titles.has(this.primaryTitle)?titles.get(this.primaryTitle):null;if(null!=t&&this.needsRegent()&&(0==this.regent||characterMap.has(this.regent)&&!characterMap.get(this.regent).alive)){var a=initSampleCharacter(!1);this.regent=a.id}if(Object.setPrototypeOf(this.council,Council.prototype),null!=t&&t.titleImportance>=2&&!this.council.exists()&&randomCouncil(this),0==this.liege&&null!=t&&0!=t.parent&&titles.has(t.parent)){this.liege=this.id;for(var r=t;this.liege==this.id;)if(0!=r.parent&&titles.has(r.parent)){var i=titles.get(r.parent);this.liege=getTitleOwner(i)}else this.liege=0}if(null!=t&&0==this.heir)if(t.titleImportance<=2)this.heir=1;else if(this.children.length>0){for(var n=0,s=0,l=0,o=0,h=0;h<this.children.length;h++){(y=this.children[h]).alive&&(y.gender==gender.FEMALE&&y.age>o?(o=y.age,l=y.id):y.gender==gender.MALE&&y.age>s&&(s=y.age,n=y.id))}if(n>0?this.heir=n:l>0&&(this.heir=l),0==this.heir){var p=this.getSiblings(),c=0,d=0,m=0,g=0;for(h=0;h<p.length;h++){var u=p[h];u.alive&&(u.gender==gender.FEMALE&&u.age>g?(g=u.age,m=u.id):u.gender==gender.MALE&&u.age>d&&(d=u.age,c=u.id))}c>0?this.heir=c:m>0&&(this.heir=m)}0==this.heir&&this.liege>0&&(this.heir=this.liege)}if(0==this.house&&this.parents.length>0)for(h=0;h<this.parents.length;h++){var f=this.parents[h];if(characterMap.has(f)){var _=characterMap.get(f);_.house>0&&(this.house=_.house)}}for(h=0;h<this.children.length;h++){var w=this.children[h];if(characterMap.has(w)){var y=characterMap.get(w);if(this.age>y.age+13||!this.alive||!y.alive)continue;e=!0,y.age>this.age||y.age<14?(this.age=y.age+getRandomNumber(14,20),this.age>90&&(this.alive=!1)):y.age=Math.max(1,this.age-13)}}if(!this.alive)for(h=0;h<this.titles.length;h++){var C=this.titles[h];if(titles.has(C)){var T=titles.get(C);if(getTitleOwner(T)==this.id&&this.heir>0&&characterMap.has(this.heir)){var b=characterMap.get(this.heir),v=this.primaryTitle==C;b.primaryTitle>0&&titles.has(b.primaryTitle)&&titles.get(b.primaryTitle).titleImportance>=T.titleImportance&&(v=!1),b.addTitle(C,v),setTitleOwner(T,this.id)}}}return e},Character.prototype.getRulerType=function(){return this.hasOwnProperty("rulerType")?this.rulerType:0},Character.prototype.getSiblings=function(){var e=[],t=this.getFather();if(t>0)for(var a=characterMap.get(t),r=0;r<a.children.length;r++){(s=a.children[r])==this.id||e.includes(s)||e.push(s)}var i=this.getMother();if(i>0){var n=characterMap.get(i);for(r=0;r<n.children.length;r++){var s;(s=n.children[r])==this.id||e.includes(s)||e.push(s)}}return e},Character.prototype.getMother=function(){for(var e=0;e<this.parents.length;e++)if(characterMap.has(this.parents[e])&&characterMap.get(this.parents[e]).gender==gender.FEMALE)return this.parents[e];return 0},Character.prototype.getFather=function(){for(var e=0;e<this.parents.length;e++)if(characterMap.has(this.parents[e])&&characterMap.get(this.parents[e]).gender==gender.MALE)return this.parents[e];return 0},Character.prototype.addTitle=function(e,t){if(this.titles.includes(e)||this.titles.push(e),t&&(this.primaryTitle=e),titles.has(e)){var a=titles.get(e);1==a.titleImportance&&t&&0==this.rulerType&&(a.holdingType==holdingtypes.CASTLE?this.rulerType=1:a.holdingType==holdingtypes.CITY?this.rulerType=2:a.holdingType==holdingtypes.TEMPLE&&(this.rulerType=3)),1==a.titleImportance&&a.parent>0&&titles.has(a.parent)&&titles.get(a.parent).primaryHolding==e&&(this.titles.push(a.parent),t&&(this.primaryTitle=a.parent))}},Character.prototype.addTitleClaim=function(e,t){var a=getTitleByName(e);if(0==a){var r=titleIterator++,i=1==t?new Holding(e,r):2==t?new County(e,r):3==t?new Duchy(e,r):4==t?new Kingdom(e,r):new Empire(e,r);titles.set(i.id,i),a=i.id}this.claims.push(a)},Character.prototype.getStateAttributes=function(){var e=this.getCK2Stats(),t=[];this.regent>0&&(e=characterMap.get(this.regent).getCK2Stats(),t.push(this.regent));if(this.council){if(this.council.chancellor>0&&this.council.chancellor!=this.regent){var a=characterMap.get(this.council.chancellor);t.push(this.council.chancellor);var r=a.getCK2Stats();e[0]=e[0]+r[0]}if(this.council.marshal>0&&this.council.marshal!=this.regent){var i=characterMap.get(this.council.marshal);t.push(this.council.marshal);r=i.getCK2Stats();e[1]=e[1]+r[1]}if(this.council.steward>0&&this.council.steward!=this.regent){var n=characterMap.get(this.council.steward);t.push(this.council.steward);r=n.getCK2Stats();e[2]=e[2]+r[2]}if(this.council.spymaster>0&&this.council.spymaster!=this.regent){var s=characterMap.get(this.council.spymaster);t.push(this.council.spymaster);r=s.getCK2Stats();e[3]=e[3]+r[3]}if(this.council.chaplain>0&&this.council.chaplain!=this.regent){var l=characterMap.get(this.council.chaplain);t.push(this.council.chaplain);r=l.getCK2Stats();e[4]=e[4]+r[4]}}if(this.spouse>0&&!t.includes(this.spouse)){var o=characterMap.get(this.spouse).getCK2Stats();e[0]=e[0]+Math.floor(.5*o[0]),e[1]=e[1]+Math.floor(.5*o[1]),e[2]=e[2]+Math.floor(.5*o[2]),e[3]=e[3]+Math.floor(.5*o[3]),e[4]=e[4]+Math.floor(.5*o[4])}return e},Character.prototype.addTrait=function(e){this.traits.includes(e)||this.traits.push(e)},Character.prototype.addVassal=function(e){this.vassals.includes(e)||this.vassals.push(e)},Character.prototype.getImportance=function(){return this.hasPrimaryTitle()?titles.get(this.primaryTitle).titleImportance:0},Character.prototype.hasPrimaryTitle=function(){return this.primaryTitle>0&&titles.has(this.primaryTitle)},Character.prototype.getDndModifier=function(e){var t=Math.floor((e-10)/2);return t>=0?"+"+t:t},Character.prototype.getDndStats=function(){var e=[];return e.push(this.dndattributes.strength),e.push(this.dndattributes.dexterity),e.push(this.dndattributes.constitution),e.push(this.dndattributes.intelligence),e.push(this.dndattributes.wisdom),e.push(this.dndattributes.charisma),e.push(this.getDndModifier(this.dndattributes.strength)),e.push(this.getDndModifier(this.dndattributes.dexterity)),e.push(this.getDndModifier(this.dndattributes.constitution)),e.push(this.getDndModifier(this.dndattributes.intelligence)),e.push(this.getDndModifier(this.dndattributes.wisdom)),e.push(this.getDndModifier(this.dndattributes.charisma)),e},Character.prototype.getCK2Stats=function(){for(var e=this.ck2attributes.diplomacy,t=this.ck2attributes.martial,a=this.ck2attributes.stewardship,r=this.ck2attributes.intrigue,i=this.ck2attributes.learning,n=this.ck2attributes.combat,s=GetTraits(),l=0;l<this.traits.length;l++){var o=this.traits[l];if(s.has(o)){var h=s.get(o);e+=h.diplomacy,t+=h.martial,a+=h.stewardship,r+=h.intrigue,i+=h.learning,n+=h.combat}}return[e,t,a,r,i,n]},Character.prototype.getRaceImage=function(){var e="profile/race/";return this.dndattributes.race==race.DRAGONBORN?e+"dragonborn.png":this.dndattributes.race==race.DWARFMOUNTAIN||this.dndattributes.race==race.DWARFHILL?e+"dwarf.png":this.dndattributes.race==race.ELFHIGH||this.dndattributes.race==race.ELFWOOD||this.dndattributes.race==race.DROW?e+"elf.png":this.dndattributes.race==race.HALFELF?e+"halfelf.png":this.dndattributes.race==race.HALFLINGSTOUT||this.dndattributes.race==race.HALFLINGLIGHTFOOT?e+"halfling.png":this.dndattributes.race==race.HALFORC?e+"halforc.png":this.dndattributes.race==race.ORC?e+"orc.png":this.dndattributes.race==race.TIEFLING?e+"tiefling.png":e+"human.png"},Character.prototype.getAlignmentText=function(){return this.dndattributes.alignment==alignments.CN?"Chaotic Neutral":this.dndattributes.alignment==alignments.LN?"Lawful Neutral":this.dndattributes.alignment==alignments.NG?"Neutral Good":this.dndattributes.alignment==alignments.CG?"Chaotic Good":this.dndattributes.alignment==alignments.LG?"Lawful Good":this.dndattributes.alignment==alignments.NE?"Neutral Evil":this.dndattributes.alignment==alignments.LE?"Lawful Evil":this.dndattributes.alignment==alignments.CE?"Chaotic Evil":"Neutral"},Character.prototype.getAlignmentImage=function(){var e="profile/alignment/";return this.dndattributes.alignment==alignments.CN?e+"chaotic_neutral.png":this.dndattributes.alignment==alignments.LN?e+"lawful_neutral.png":this.dndattributes.alignment==alignments.NG?e+"good.png":this.dndattributes.alignment==alignments.CG?e+"chaotic_good.png":this.dndattributes.alignment==alignments.LG?e+"lawful_good.png":this.dndattributes.alignment==alignments.NE?e+"evil.png":this.dndattributes.alignment==alignments.LE?e+"lawful_evil.png":this.dndattributes.alignment==alignments.CE?e+"chaotic_evil.png":e+"neutral.png"},Character.prototype.GetSeed=function(){return this.portraitData.backgroundIndex+"-"+this.portraitData.hairIndex+"-"+this.portraitData.hairColor+"-"+this.portraitData.clothes+"-"+this.portraitData.cheeks+"-"+this.portraitData.chin+"-"+this.portraitData.eyes+"-"+this.portraitData.eyeColor+"-"+this.portraitData.ear+"-"+this.portraitData.neck+"-"+this.portraitData.mouth+"-"+this.portraitData.nose+"-"+this.portraitData.beard},Character.prototype.ParseSeed=function(e){var t,a=e.split("-"),r=this.gender==gender.FEMALE;a.length>0&&((t=parseInt(a[0]))>=0&&t<32&&(this.portraitData.backgroundIndex=t));a.length>1&&((t=parseInt(a[1]))>=0&&t<(r?13:14)&&(this.portraitData.hairIndex=t));a.length>2&&((t=parseInt(a[2]))>=0&&t<3&&(this.portraitData.hairColor=t));a.length>3&&((t=parseInt(a[3]))>=0&&t<12&&(this.portraitData.clothes=t));a.length>4&&((t=parseInt(a[4]))>=0&&t<11&&(this.portraitData.cheeks=t));a.length>5&&((t=parseInt(a[5]))>=0&&t<13&&(this.portraitData.chin=t));a.length>6&&((t=parseInt(a[6]))>=0&&t<13&&(this.portraitData.eyes=t));a.length>7&&((t=parseInt(a[7]))>=0&&t<3&&(this.portraitData.eyeColor=t));a.length>8&&((t=parseInt(a[8]))>=0&&t<(r?13:10)&&(this.portraitData.ear=t));a.length>9&&((t=parseInt(a[9]))>=0&&t<4&&(this.portraitData.neck=t));a.length>10&&((t=parseInt(a[10]))>=0&&t<13&&(this.portraitData.mouth=t));a.length>11&&((t=parseInt(a[11]))>=0&&t<13&&(this.portraitData.nose=t));a.length>12&&(r?this.portraitData.beard=0:(t=parseInt(a[12]))>=0&&t<8&&(this.portraitData.beard=t))},Character.prototype.IsIndependent=function(){return 0==this.regent},Character.prototype.calculateTitles=function(e){var t=[];for(var[a,r]of e.entries())r instanceof Empire?r.owner==this.id&&t.push(a):r instanceof Kingdom?r.owner==this.id&&t.push(a):r instanceof Duchy?r.owner==this.id&&t.push(a):r instanceof County?r.holdings.size>0&&r.holdings[0].owner==this.id&&t.push(a):r instanceof Holding&&r.owner==this.id&&t.push(a);return t};var maleNames=["Abel","Alan","Alberto","Alexis","Amos","Angel","Angelo","Anibal","Anthony","Antone","Aurelio","Barrett","Basil","Bennett","Bernard","Blair","Bob","Brad","Bradford","Bradley","Brandon","Brendan","Brendon","Bryan","Bryce","Bud","Carl","Carlo","Carmine","Carol","Carroll","Cedric","Cesar","Chance","Chang","Chase","Christopher","Cliff","Coleman","Colton","Courtney","Cristopher","Curt","Curtis","Damian","Damien","Dana","Danny","Daron","Dave","Davis","Dennis","Dion","Donnie","Donovan","Dorsey","Douglass","Dwight","Earnest","Ed","Eduardo","Edward","Elbert","Ellsworth","Erasmo","Eric","Erick","Erik","Erin","Errol","Eugenio","Evan","Fidel","Floyd","Forest","Francis","Franklin","Fred","Fredrick","Gabriel","Galen","Gary","Gaston","Gilberto","Gordon","Grant","Greg","Guadalupe","Guy","Hal","Harland","Harold","Harris","Harvey","Hector","Heriberto","Horacio","Hoyt","Hubert","Hyman","Ira","Irwin","Isidro","Ismael","Isreal","Ivan","Jacinto","Jackson","Jame","James","Jarred","Jean","Jerold","Jerome","Jeromy","Jim","Joaquin","Jody","Joel","Johnson","Jon","Jonah","Jonathon","Josue","Judson","Julian","Julius","Junior","Justin","Kristopher","Lanny","Larry","Laurence","Lawerence","Lawrence","Lazaro","Leandro","Lemuel","Lenard","Leon","Leonard","Linwood","Lonnie","Louis","Luke","Margarito","Marquis","Mathew","Matt","Melvin","Michal","Millard","Monroe","Moshe","Myron","Ned","Newton","Noble","Noe","Norbert","Normand","Numbers","Octavio","Oren","Orval","Oscar","Osvaldo","Oswaldo","Perry","Phillip","Quintin","Raul","Raymon","Refugio","Reinaldo","Reynaldo","Ricardo","Richard","Roderick","Rodger","Rolf","Roosevelt","Rory","Rosendo","Roy","Royal","Ruben","Russ","Ryan","Sammy","Scott","Sebastian","Seth","Shawn","Silas","Simon","Stephen","Stuart","Tanner","Taylor","Ted","Teddy","Terrence","Terry","Thad","Toby","Tommy","Tony","Tory","Trent","Troy","Valentin","Valentine","Victor","Vince","Vito","Walker","Waylon","Willard","William","Winford","Winfred","Xavier","Yong","Zack"],femaleNames=["Abbie","Ailene","Aleta","Alina","Alisha","Allegra","Alona","Alvera","Alyce","Alyson","Amanda","Ana","Angela","Angelika","Angeline","Angie","Anisha","Annamae","Annamarie","Annita","Antonette","Antonina","Audrea","Aundrea","Beatrice","Becki","Belen","Belle","Berniece","Bernita","Beryl","Britta","Brook","Calandra","Candida","Carla","Carlota","Carolynn","Cassandra","Cassaundra","Chana","Chantell","Charise","Cherelle","Cherlyn","Christina","Cierra","Cindie","Clementina","Cordia","Corrinne","Daina","Daniela","Darleen","Deadra","Debbie","Deborah","Deeann","Deedee","Delana","Delmy","Demetria","Desirae","Dina","Dionna","Dolly","Donya","Dortha","Dyan","Ebonie","Elaine","Elizabet","Elli","Elsa","Elvie","Emely","Emerald","Esta","Ester","Eusebia","Evie","Fay","Felice","Florinda","Fredricka","Gia","Gillian","Giuseppina","Glynis","Golda","Gwen","Gwenn","Hilma","Hui","Illa","Ima","Inge","Iva","Izetta","Jacinda","Janessa","Jani","Jeanmarie","Jenelle","Jennine","Jesusa","Jolene","Judie","Juliana","Julienne","Junko","Karena","Karima","Karolyn","Karren","Kathe","Kenisha","Keva","Khalilah","Kina","Kirstin","Krystina","Ladonna","Lakia","Lakisha","Lanell","Lani","Lanora","Latonia","Laurel","Lavonia","Lawanda","Layla","Leanora","Lezlie","Librada","Lila","Lili","Linh","Linnie","Linsey","Loralee","Lorraine","Lourie","Lucina","Madison","Mahalia","Maire","Malka","Manie","Maragret","Marcell","Marcene","Margarette","Marguerita","Maribel","Marquitta","Marvella","Maude","Maurita","Melina","Merri","Mi","Milissa","Monique","Monserrate","Nada","Nan","Nerissa","Nevada","Nichole","Nicolette","Nila","Noelia","Ok","Oliva","Pamelia","Patience","Patti","Pattie","Paulita","Peggie","Priscilla","Prudence","Racquel","Regan","Regenia","Regine","Rochel","Rozanne","Salena","Salina","Sallie","Sandee","Santa","Shani","Shantae","Shantay","Shaunna","Shaunta","Shawnna","Shay","Shea","Sherlene","Sherry","Sheryl","Shizue","Signe","Skye","Sophie","Starr","Sylvia","Tabatha","Taneka","Tara","Tarsha","Tawna","Teressa","Thersa","Thresa","Tiana","Tillie","Tonette","Tran","Twanna","Ulrike","Valeria","Vanna","Vannessa","Vergie","Violet","Wanda","Waneta","Winnie","Winona","Yan","Yanira","Yoko","Yolanda","Yoshie","Yun","Yvone","Zita","Zulema"],ClickableShape=function(e,t,a,r,i,n){this.minX=e,this.minY=t,this.maxX=a,this.maxY=r,this.description=i,this.action=n};ClickableShape.prototype.isInShape=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY};var MouseOverShape=function(e,t,a,r,i){this.minX=e,this.minY=t,this.maxX=a,this.maxY=r,this.description=i};function getMinMaxClickableBounds(e){if(!e||0==e.length)return new ClickableShape(0,0,1,1,"",null);for(var t=e[0].minX,a=e[0].minY,r=e[0].maxX,i=e[0].maxY,n=1;n<e.length;n++){var s=e[n];s.minX<t&&(t=s.minX),s.minY<a&&(a=s.minY),s.maxX>r&&(r=s.maxX),s.maxY>i&&(i=s.maxY)}return new ClickableShape(t,a,r,i,"",null)}function getMinMaxBounds(e){if(!e||0==e.length)return new MouseOverShape(0,0,1,1,"");for(var t=e[0].minX,a=e[0].minY,r=e[0].maxX,i=e[0].maxY,n=1;n<e.length;n++){var s=e[n];s.minX<t&&(t=s.minX),s.minY<a&&(a=s.minY),s.maxX>r&&(r=s.maxX),s.maxY>i&&(i=s.maxY)}return new MouseOverShape(t,a,r,i,"")}MouseOverShape.prototype.isInShape=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY};var Shape=function(e,t,a,r,i,n,s){this.x=e,this.y=t,this.zIndex=a,this.width=i,this.height=n,this.image=new Image,this.image.src=r,this.partial=!1,this.partialX=0,this.partialY=0,this.partialWidth=0,this.partialHeight=0,this.targetId=s,this.targetCanvas=null,this.targetContext=null};Shape.prototype.draw=function(){if(this.targetContext){if(null==this.image)return;this.partial?this.targetContext.drawImage(this.image,this.partialX,this.partialY,this.partialWidth,this.partialHeight,this.x,this.y,this.width,this.height):this.targetContext.drawImage(this.image,this.x,this.y,this.width,this.height)}},Shape.prototype.resolve=function(e){if(e.has(this.targetId)){var t=e.get(this.targetId);this.targetCanvas=t[0],this.targetContext=t[1]}else this.targetCanvas=document.getElementById(this.targetId),this.targetContext=this.targetCanvas.getContext("2d"),makeCanvasPretty(this.targetContext),e.set(this.targetId,[this.targetCanvas,this.targetContext])};var TextLabel=function(e,t,a,r,i,n,s,l,o,h,p=!1){this.x=e,this.y=t,this.zIndex=a,this.maxWidth=r,this.fontSize=i,this.text=n,this.color=l,this.textalign=s,this.bold=o,this.targetId=h,this.targetCanvas=null,this.targetContext=null,this.useTrajan=p};TextLabel.prototype.draw=function(){if(this.targetContext){this.useTrajan?this.targetContext.font=this.fontSize+"px Trajan Pro 3":this.targetContext.font=(this.bold?"bold ":"")+this.fontSize+"px Garamond";var e=this.targetContext.fillStyle,t=this.targetContext.textAlign;this.targetContext.textAlign=this.textalign,this.targetContext.fillStyle=this.color,this.targetContext.fillText(this.text,this.x,this.y,this.maxWidth),this.targetContext.fillStyle=e,this.targetContext.textAlign=t}},TextLabel.prototype.resolve=function(e){if(e.has(this.targetId)){var t=e.get(this.targetId);this.targetCanvas=t[0],this.targetContext=t[1]}else this.targetCanvas=document.getElementById(this.targetId),this.targetCanvas&&(this.targetContext=this.targetCanvas.getContext("2d"),makeCanvasPretty(this.targetContext),e.set(this.targetId,[this.targetCanvas,this.targetContext]))};var RenderedImage=function(e,t,a,r,i,n,s){this.x=e,this.y=t,this.zIndex=a,this.width=r,this.height=i,this.sourceId=n,this.targetId=s,this.targetCanvas=null,this.targetContext=null,this.sourceCanvas=null,this.sourceContext=null};function makeCanvasPretty(e){void 0!==e.imageSmoothingQuality&&(e.imageSmoothingQuality="high")}RenderedImage.prototype.draw=function(){this.targetContext&&this.sourceCanvas&&this.targetContext.drawImage(this.sourceCanvas,this.x,this.y,this.width,this.height)},RenderedImage.prototype.resolve=function(e){if(e.has(this.targetId)){var t=e.get(this.targetId);this.targetCanvas=t[0],this.targetContext=t[1]}else this.targetCanvas=document.getElementById(this.targetId),this.targetContext=this.targetCanvas.getContext("2d"),makeCanvasPretty(this.targetContext),e.set(this.targetId,[this.targetCanvas,this.targetContext]);if(e.has(this.sourceId)){t=e.get(this.sourceId);this.sourceCanvas=t[0],this.sourceContext=t[1]}else this.sourceCanvas=document.getElementById(this.sourceId),this.sourceContext=this.sourceCanvas.getContext("2d"),makeCanvasPretty(this.sourceContext),e.set(this.sourceId,[this.sourceCanvas,this.sourceContext])};var RenderStack=function(){this.elements=[],this.callback=null};function loadRenderStack(e){var t=e.getImages(),a=t.length,r=0;e.resolve();for(var i=0;i<a;i++)t[i].crossOrigin="Anonymous",t[i].setAttribute("crossOrigin","anonymous"),t[i].onload=function(){++r==a&&e.render()}}function clearCanvasFromPoint(e,t,a){targetCanvas=document.getElementById(e),targetContext=targetCanvas.getContext("2d"),targetContext.clearRect(t,a,$("#"+e).width()-t,$("#"+e).height()-a)}function clearCanvas(e){targetCanvas=document.getElementById(e),targetContext=targetCanvas.getContext("2d"),targetContext.clearRect(0,0,$("#"+e).width(),$("#"+e).height())}RenderStack.prototype.addElements=function(e){this.elements=this.elements.concat(e)},RenderStack.prototype.addElement=function(e){this.elements.push(e)},RenderStack.prototype.clear=function(){this.elements=[]},RenderStack.prototype.getImages=function(){for(var e=[],t=0;t<this.elements.length;t++)this.elements[t]instanceof Shape&&e.push(this.elements[t].image);return e},RenderStack.prototype.resolve=function(){for(var e=new Map,t=0;t<this.elements.length;t++)this.elements[t].resolve(e)},RenderStack.prototype.render=function(){var e=this.elements,t=e.map(function(e,t){return{index:t,value:e.zIndex}});t.sort(function(e,t){return e.value-t.value});for(var a=t.map(function(t){return e[t.index]}),r=0;r<a.length;r++)a[r].draw();this.callback&&this.callback()};